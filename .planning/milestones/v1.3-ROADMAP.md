# Milestone v1.3: UX Redesign

**Status:** ✅ SHIPPED 2026-01-24
**Phases:** 16-19
**Total Plans:** 16

## Overview

Reorient application around campaigns-first workflow, eliminate confusing "project" terminology, improve editor flexibility, and enhance import/export options. This milestone establishes consistent terminology throughout the application, improves import UX with modal dialogs, adds clean HTML export for email-only content, and provides flexible editor column management with keyboard shortcuts.

## Phases

### Phase 16: Terminology & Workflow Foundation

**Goal**: Rename all "project" references to "phish" and make campaigns the default landing view
**Depends on**: Phase 15
**Plans**: 4 plans

Plans:
- [x] 16-01: UI text terminology update (user-facing strings, CSS classes)
- [x] 16-02: Code terminology update (variables, functions, comments)
- [x] 16-03: LocalStorage migration script (v2 → v3)
- [x] 16-04: Campaigns-first routing (default landing view)

**Details:**
Updated all user-facing text from "project" to "phish" terminology in ProjectSettings component, storage utilities, and CSS stylesheets. Changed storage.ts default title from "Untitled Project" to "Untitled Phish". Renamed CSS class selectors from "project-settings" to "phish-settings". Created v3 migration script that renames localStorage key from "phishmonger-project-id" to "phishmonger-phish-id" and updates default title. Implemented smart default state initialization in App.tsx where showCampaignManager is initialized with hasExistingPhishData() check - new users (no custom title) see campaigns list first, existing users with custom titles see editor. All backward compatibility aliases provided for gradual migration.

### Phase 17: Import UX Improvements

**Goal**: Modal-based phish import and text input for campaign import
**Depends on**: Phase 16
**Plans**: 3 plans

Plans:
- [x] 17-01: Phish import modal UI
- [x] 17-02: Campaign import modal UI
- [x] 17-03: Integrate modals into App, ProjectSettings, and CampaignManager

**Details:**
Created PhishImportModal component (295 lines) with dual input methods: file upload via FileReader API and text paste via JSON.parse, both validated with importProjectJSON utility. Created CampaignImportModal component (325 lines) with stacked file upload button and textarea for text paste, validating structure inline. Both modals follow KeyboardShortcutHelp pattern with escape key useEffect and handleBackdropClick for clean dismissal. Integrated modals into App.tsx with showPhishImportModal and showCampaignImportModal state management. Updated ProjectSettings with onImportClick callback to trigger PhishImportModal. Updated CampaignManager with onImportClick callback to trigger CampaignImportModal. Removed anti-patterns (expanding menus, hidden file inputs).

### Phase 18: Clean HTML Export

**Goal**: Export clean email HTML from carousel view (strip lure mark divs)
**Depends on**: Phase 17
**Plans**: 3 plans

Plans:
- [x] 18-01-PLAN.md — Create cleanHtmlExport utility module with DOMParser-based sanitization
- [x] 18-02-PLAN.md — Add export UI buttons to ReadOnlyEditor component
- [x] 18-03-PLAN.md — Validate export functionality with human testing

**Details:**
Created cleanHtmlExport.ts utility module (126 lines) with 6 exported functions. DOMParser used for HTML manipulation (not regex) for reliability. stripLureMarks() removes [data-lure-id] elements matching LureMark.ts structure. stripAnnotationBadges() removes [data-annotation-number] elements matching EmailColumn.tsx. generateCleanHtml() combines both strip operations to remove all annotation artifacts. generateCleanHtmlFilename() sanitizes phish title and returns safe filename. downloadCleanHtml() uses Blob API with MIME type text/html; charset=utf-8, follows icalExport.ts pattern with URL.createObjectURL() and URL.revokeObjectURL() for memory safety. copyCleanHtmlToClipboard() uses Navigator Clipboard API with try-catch error handling, follows ReadOnlyEditor.tsx pattern. ReadOnlyEditor integrated with two new export buttons in header: green "Download Clean HTML" and orange "Copy Clean HTML". Original "Copy HTML" button (cyan) preserved for raw export. Human verification confirmed clean HTML export works correctly with no annotation artifacts, proper rendering, and preserved source data integrity.

### Phase 19: Editor Column Flexibility

**Goal**: Expandable and minimizable editor columns with keyboard shortcuts
**Depends on**: Phase 18
**Plans**: 6 plans

Plans:
- [x] 19-01-PLAN.md — Column types, storage utilities, and UI state management
- [x] 19-02-PLAN.md — CSS Grid focus variants and column header styling
- [x] 19-03-PLAN.md — LocalStorage persistence for focused column state
- [x] 19-04-PLAN.md — Keyboard shortcuts (1, 2, 3, 4) for column focus
- [x] 19-05-PLAN.md — Minimize button and collapsed columns state management (gap closure)
- [x] 19-06-PLAN.md — CSS for collapsed header bar state (gap closure)

**Details:**
Created ColumnID type definition in src/types/columns.ts with union type for type-safe column references. Added storage utilities in storage.ts: loadFocusedColumn(), saveFocusedColumn(), loadCollapsedColumns(), saveCollapsedColumns() with validation against Set of valid ColumnID values, proper error handling, and QuotaExceededError handling. Implemented column focus state management in App.tsx with focusedColumn state initialized from localStorage and toggleColumnFocus() function that toggles between focus and reset. Added 4 useHotkeys hooks for keys 1-4 with enableOnFormTags: true to allow shortcuts during text input. Created ColumnHeader component with expand button (+/−) and minimize button (↓/↑) in header. ColumnHeader added to all 4 columns: Email Input, Preview, Annotations (lure-list), Scoring. CSS Grid conditional layouts with data-focus-column attribute on .app-main. 4 data-focus-column selectors set grid-template-columns to 1fr/0 values. 0.3s CSS transition on .app-main provides smooth animation. Hidden columns use min-width: 0 and overflow: hidden to prevent layout interference. Added collapsed columns state management with toggleColumnCollapsed() function and Set<ColumnID> for supporting multiple simultaneous collapses. Minimize button (↓/↑) added to ColumnHeader allowing independent column collapse without affecting focus mode. Added data-collapsed attribute binding on all 4 column containers. .column-collapsed CSS sets width to 40px with !important to override focus-mode grid widths. writing-mode: vertical-rl on collapsed column headers maximizes space efficiency while keeping labels readable. :not(.column-header) selector hides all column content except header when collapsed.

---

## Milestone Summary

**Decimal Phases:**
None - No decimal phases inserted during this milestone

**Key Decisions:**
- Decision: Terminology change from "project" to "phish" affects UI, code, and localStorage keys (Rationale: Consistent user-facing language, eliminate confusion about "projects")
- Decision: Campaigns-first workflow means campaigns list is default landing view (Rationale: Reorient application around campaigns-first usage while maintaining backward compatibility)
- Decision: LocalStorage migration from v2 to v3 required for key rename (Rationale: Preserve existing user data while changing storage schema)
- Decision: Maintain backward compatibility for existing users (Rationale: Migration script runs on app mount, aliases provided for gradual code migration)
- Decision: Modal pattern established via KeyboardShortcutHelp (Rationale: Escape key + backdrop click, consistent UX pattern across application)
- Decision: Dual input methods for phish and campaign import (Rationale: File upload easiest for exported JSON, text paste faster for clipboard copy)
- Decision: State reset on modal close prevents stale errors (Rationale: Clean state between modal opens prevents stale content and error messages)
- Decision: Centralized modal state management in App.tsx (Rationale: Consistent state management, easier maintenance)
- Decision: Callback prop pattern (onImportClick) used for modal triggers (Rationale: Decouple child components from state, better testability)
- Decision: DOMParser-based HTML sanitization used instead of regex (Rationale: More reliable for HTML manipulation, handles nested tags and malformed markup correctly)
- Decision: Pure function design for export utilities (Rationale: No source data mutation, export is derivative operation, easier to test and reason about)
- Decision: Separate filename generation function (Rationale: Enables reuse for other export formats, follows single responsibility principle)
- Decision: Preserved original "Copy HTML" button alongside clean HTML export (Rationale: Dual export options provide flexibility for users who want raw vs clean HTML)
- Decision: Color-coded export buttons (Rationale: Visual differentiation - green for download, orange for copy)
- Decision: Single expand button (+/−) in column header (Rationale: Cleaner UI, clearer intent for toggle behavior)
- Decision: ColumnID union type provides type-safe column references (Rationale: Compile-time validation, prevents invalid column IDs)
- Decision: Focused column state persisted with validation against Set of valid ColumnID (Rationale: Robust error handling, prevents invalid localStorage values from corrupting state)
- Decision: CSS Grid conditional layouts with data attributes (Rationale: Better performance than JavaScript-style manipulation, easier to maintain)
- Decision: 0.3s CSS transition on grid-template-columns (Rationale: Provides smooth column collapse/expand animation)
- Decision: Hidden columns use min-width: 0 and overflow: hidden (Rationale: Prevents layout interference from collapsed columns)
- Decision: Separate minimize button (↓/↑) in column header (Rationale: Allows independent column collapse without affecting focus mode)
- Decision: Set<ColumnID> for collapsedColumns state (Rationale: Enables multiple columns to be minimized simultaneously)
- Decision: CSS !important on collapsed column width properties (Rationale: Overrides focus-mode grid widths (0px) for simultaneous collapsed + focus states)
- Decision: writing-mode: vertical-rl on collapsed column headers (Rationale: Maximizes space efficiency while keeping labels readable)
- Decision: Number keys (1-4) used for navigation mode (Rationale: Aligned with power-user workflow, enableOnFormTags: true allows shortcuts during text input)

**Issues Resolved:**
- Terminology confusion throughout application - "project" vs "phish" - Resolved by comprehensive rename across UI, code, localStorage, and database schema
- Inconsistent landing view - users didn't know whether to start with campaigns or standalone editor - Resolved by smart default state initialization (new users → campaigns, existing users → editor)
- Layout shift from expanding menus for import - Resolved by modal pattern with fixed backdrop overlay
- No text paste option for campaign import - Resolved by adding textarea input field in CampaignImportModal
- No way to export email-only HTML - Resolved by cleanHtmlExport utility that strips lure marks and annotation badges
- Inflexible editor layout - Resolved by column focus mode with keyboard shortcuts and minimize/collapse functionality

**Issues Deferred:**
None - No issues deferred during this milestone

**Technical Debt Incurred:**
None - No shortcuts or deferred work accumulated during this milestone

---

_For current project status, see .planning/ROADMAP.md_