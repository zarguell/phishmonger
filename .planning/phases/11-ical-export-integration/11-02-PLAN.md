---
phase: 11-ical-export-integration
plan: 02
type: execute
wave: 2
depends_on: [11-01]
files_modified:
  - src/components/campaign/CampaignCard.tsx
  - src/components/campaign/CampaignManager.tsx
autonomous: false
must_haves:
  truths:
    - "CampaignCard displays Export Calendar button alongside existing buttons"
    - "Clicking Export Calendar downloads .ics file with campaign events"
    - "CampaignManager passes onExportICal handler to CampaignCard"
    - "Exported .ics file can be imported into external calendar applications"
  artifacts:
    - path: "src/components/campaign/CampaignCard.tsx"
      provides: "Export Calendar button in campaign list view"
      contains: "onExportICal"
    - path: "src/components/campaign/CampaignManager.tsx"
      provides: "iCal export handler using downloadCampaignICal utility"
      contains: "import.*icalExport|handleExportICal"
  key_links:
    - from: "CampaignCard"
      to: "icalExport.ts"
      via: "onExportICal prop callback"
      pattern: "onExportICal.*=.*handleExportICal"
    - from: "CampaignManager.handleExportICal"
      to: "downloadCampaignICal"
      via: "import and function call"
      pattern: "downloadCampaignICal\\(campaign\\)"
---

<objective>
Integrate iCal export into campaign UI with Export Calendar button

Purpose: Users can export campaigns to .ics files directly from the campaign list view
Output: Working Export Calendar button in CampaignCard that downloads .ics file
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/11-ical-export-integration/11-CONTEXT.md
@.planning/phases/11-ical-export-integration/11-RESEARCH.md
@.planning/ROADMAP.md
@.planning/phases/11-ical-export-integration/11-01-SUMMARY.md

@src/types/campaign.ts
@src/components/campaign/CampaignCard.tsx
@src/components/campaign/CampaignManager.tsx
@src/utils/icalExport.ts
</context>

<tasks>

<task type="auto">
  <name>Add Export Calendar button to CampaignCard</name>
  <files>src/components/campaign/CampaignCard.tsx</files>
  <action>
    Modify CampaignCard component to add iCal export capability:

    1. Add onExportICal prop to CampaignCardProps interface:
       interface CampaignCardProps {
         campaign: Campaign;
         onEdit: () => void;
         onDelete: () => void;
         onExport: () => void;
         onExportICal: () => void;  // NEW
       }

    2. Add Export Calendar button to the button group (line ~109-153):
       - Place after existing Export button (line ~139-152)
       - Use onClick={onExportICal}
       - Style with:
         * padding: '6px 12px'
         * fontSize: '13px'
         * backgroundColor: '#28a745' (green to distinguish from other actions)
         * color: 'white'
         * border: 'none'
         * borderRadius: '4px'
         * cursor: 'pointer'
       - Button text: "Export Calendar"

    3. Update function signature: export function CampaignCard({ campaign, onEdit, onDelete, onExport, onExportICal }: CampaignCardProps)

    Follow existing button styling pattern in CampaignCard. Green color indicates download/export action distinct from Edit (blue) and Delete (red).
  </action>
  <verify>grep -n "onExportICal" src/components/campaign/CampaignCard.tsx returns prop interface and button</verify>
  <done>CampaignCard accepts onExportICal prop and renders Export Calendar button</done>
</task>

<task type="auto">
  <name>Wire up iCal export handler in CampaignManager</name>
  <files>src/components/campaign/CampaignManager.tsx</files>
  <action>
    Modify CampaignManager to handle iCal export:

    1. Add import at top of file:
       import { downloadCampaignICal } from '../../utils/icalExport';

    2. Add handleExportICal function after handleExport (around line ~63):
       const handleExportICal = (campaign: Campaign) => {
         try {
           downloadCampaignICal(campaign);
         } catch (error) {
           console.error('Failed to export iCal:', error);
         }
       };

    3. Pass onExportICal prop to CampaignCard in the map (around line ~288-294):
       <CampaignCard
         key={campaign.id}
         campaign={campaign}
         onEdit={() => onEditCampaign(campaign)}
         onDelete={() => handleDelete(campaign)}
         onExport={() => handleExport(campaign)}
         onExportICal={() => handleExportICal(campaign)}  // NEW
       />

    Follow existing error handling pattern from handleImport (try/catch with console.error).
  </action>
  <verify>grep -n "handleExportICal\|onExportICal" src/components/campaign/CampaignManager.tsx returns handler and prop</verify>
  <done>CampaignManager calls downloadCampaignICal when Export Calendar button clicked</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete iCal export integration with Export Calendar button in campaign list</what-built>
  <how-to-verify>
    1. Start dev server: npm run dev
    2. Create a test campaign with at least 2 phishes, each with different scheduled dates
    3. Open Campaigns modal and locate the test campaign card
    4. Click the "Export Calendar" button
    5. Verify .ics file downloads with filename format "{campaign-name}_calendar.ics"
    6. Open the downloaded .ics file in a text editor and verify:
       - Contains BEGIN:VCALENDAR and END:VCALENDAR
       - Contains one VEVENT per scheduled phish
       - Event titles follow format "Campaign Name: Phish Title"
       - Events have DTSTART and DTEND with 9:00 AM UTC time
    7. Test import into a calendar application (Google Calendar, Outlook, or Apple Calendar):
       - Import the .ics file
       - Verify events appear on correct dates
       - Verify event titles are readable
  </how-to-verify>
  <resume-signal>Type "approved" if iCal export works correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. CampaignCard has onExportICal prop in interface
2. Export Calendar button appears in campaign card button group
3. CampaignManager imports downloadCampaignICal
4. CampaignManager has handleExportICal function
5. handleExportICal is passed to CampaignCard
6. Clicking Export Calendar downloads .ics file
7. .ics file contains correct event data
8. File can be imported into external calendar applications
</verification>

<success_criteria>
1. Export Calendar button is visible in campaign list view
2. Clicking button triggers .ics file download
3. Downloaded file has correct .ics extension
4. File contains one VEVENT per scheduled phish
5. Event titles format: "Campaign Name: Phish Title"
6. Events appear correctly when imported into calendar application
</success_criteria>

<output>
After completion, create `.planning/phases/11-ical-export-integration/11-02-SUMMARY.md`
</output>
