---
phase: 08-deferred-v1-0-work
plan: 06
type: execute
wave: 2
depends_on: [08-05]
files_modified:
  - src/components/library/CustomTechniqueEditor.tsx
  - src/App.tsx
  - src/index.css
autonomous: false

must_haves:
  truths:
    - "User can create custom technique with name, ID, tactic, description, URL"
    - "Custom technique editor validates required fields"
    - "New custom technique appears in technique dropdown after creation"
    - "Custom techniques are visually distinguished from built-in techniques"
  artifacts:
    - path: "src/components/library/CustomTechniqueEditor.tsx"
      provides: "Form component for creating/editing custom techniques"
      min_lines: 80
  key_links:
    - from: "src/components/library/CustomTechniqueEditor.tsx"
      to: "src/hooks/useCustomTechniques.ts"
      via: "import useCustomTechniques hook"
      pattern: "useCustomTechniques"
    - from: "src/components/AnnotationPanel.tsx"
      to: "src/components/library/CustomTechniqueEditor.tsx"
      via: "Modal integration for technique creation"
      pattern: "CustomTechniqueEditor"
---

<objective>
Custom technique editor for user-defined phishing techniques.

Purpose: Users can create organization-specific or training-specific phishing techniques that don't exist in the MITRE ATT&CK catalog.
Output: Form modal for creating custom techniques with validation and integration into technique selection.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/08-deferred-v1-0-work/08-DEFERRED-V1-0-WORK-RESEARCH.md

# Only reference prior plan SUMMARYs if genuinely needed
@.planning/phases/08-deferred-v1-0-work/08-05-SUMMARY.md
@src/components/AnnotationPanel.tsx
@src/types/library.ts
@src/hooks/useCustomTechniques.ts
@src/data/techniques.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CustomTechniqueEditor component</name>
  <files>src/components/library/CustomTechniqueEditor.tsx</files>
  <action>
    Create src/components/library/CustomTechniqueEditor.tsx form modal:

    Props:
    - isOpen: boolean
    - onClose: () => void
    - onSave: (technique: Omit<CustomTechnique, 'id' | 'isCustom' | 'createdAt'>) => void
    - editTechnique?: CustomTechnique (for editing existing)

    Form fields:
    - ID (text, required, format hint: "CUSTOM-001 or similar")
    - Name (text, required)
    - Tactic (text, required, e.g., "Initial Access", "Social Engineering")
    - Description (textarea, required)
    - URL (text, optional, https://...)
    - Organization (text, optional)

    Validation:
    - All required fields must be filled
    - ID must be unique (check against existing techniques)
    - URL must be valid format if provided

    UX:
    - "Create Custom Technique" header
    - "Cancel" and "Save Technique" buttons
    - Error messages display inline
    - Modal overlay with backdrop

    Use controlled inputs with local state, call onSave with form data on submit.
  </action>
  <verify>test -f src/components/library/CustomTechniqueEditor.tsx && grep -q "CustomTechniqueEditor" src/components/library/CustomTechniqueEditor.tsx</verify>
  <done>CustomTechniqueEditor modal with form validation</done>
</task>

<task type="auto">
  <name>Task 2: Integrate editor into AnnotationPanel</name>
  <files>src/components/AnnotationPanel.tsx</files>
  <action>
    Integrate custom technique creation into AnnotationPanel:

    1. Import useCustomTechniques hook
    2. Add "Create Custom Technique" button to technique dropdown
    3. Add state for editor modal open/close
    4. Handle custom technique creation:
       - Call addCustomTechnique with form data
       - Close modal on success
       - Show error message on failure
    5. Merge custom techniques into technique options:
       - Use getAllTechniques(builtInTechniques) to get combined list
       - Sort with built-ins first, then custom techniques
       - Distinguish custom techniques visually (e.g., "[Custom]" prefix or different color)

    The technique dropdown should now show both built-in and custom techniques.

    Do NOT add a separate "Technique Library" button - editor should be accessible from the existing technique selection workflow.
  </action>
  <verify>grep -q "useCustomTechniques" src/components/AnnotationPanel.tsx && grep -q "Create Custom Technique" src/components/AnnotationPanel.tsx</verify>
  <done>AnnotationPanel integrated with custom technique creation workflow</done>
</task>

<task type="checkpoint:human-verify">
  <what-built>Complete custom technique editor integrated into annotation workflow</what-built>
  <how-to-verify>
    1. Open an annotation in Edit Mode
    2. Click the technique dropdown
    3. Click "Create Custom Technique" button
    4. Fill in form: ID "CUSTOM-TEST", Name "Test Technique", Tactic "Social Engineering", Description "A test technique"
    5. Click "Save Technique"
    6. Verify custom technique appears in dropdown
    7. Select the custom technique
    8. Verify annotation shows custom technique tag
    9. Try creating duplicate ID - verify error message
    10. Refresh page - verify custom technique persists
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues with editor form or technique selection</resume-signal>
</task>

</tasks>

<verification>
1. Custom technique editor modal opens from technique dropdown
2. Form validates all required fields
3. Duplicate IDs are rejected with error message
4. Custom techniques appear in technique dropdown after creation
5. Custom techniques are visually distinguished from built-ins
6. Created techniques persist across page refresh
7. Annotations can use custom techniques
</verification>

<success_criteria>
- Users can create organization-specific techniques
- Form validation prevents invalid data
- Custom techniques integrate seamlessly with existing workflow
- Visual distinction between built-in and custom techniques
</success_criteria>

<output>
After completion, create `.planning/phases/08-deferred-v1-0-work/08-06-SUMMARY.md`
</output>
