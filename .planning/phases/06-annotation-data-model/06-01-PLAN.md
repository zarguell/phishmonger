---
phase: 06-annotation-data-model
plan: 06-01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/annotations.ts
  - src/components/AnnotationPanel.tsx
  - src/utils/storage.ts
autonomous: true
must_haves:
  truths:
    - "User can add a freetext title to any annotation"
    - "Title appears in bold at the top of the annotation card"
    - "Existing annotations without titles work correctly"
  artifacts:
    - path: src/types/annotations.ts
      provides: "Annotation type with optional title field"
      contains: "title\\?: string"
    - path: src/components/AnnotationPanel.tsx
      provides: "Title input field in annotation form"
      contains: "title.*input|title.*text"
  key_links:
    - from: src/components/AnnotationPanel.tsx
      to: src/types/annotations.ts
      via: "title field in Annotation type"
      pattern: "annotation\\.title|title=\\{"
---

<objective>
Add optional `title` field to Annotation type and UI. This enables freetext titles that appear bold in the visualizer (ANN-09).
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md

# Current Annotation interface (src/types/annotations.ts):
```typescript
export interface Annotation {
  lureId: string
  techniqueId: string
  persuasionPrincipleId?: string
  explanation: string
  createdAt: string
  annotationNumber?: number
  manualY?: number
}
```

# AnnotationPanel uses annotation fields for form inputs:
- techniqueId → select dropdown
- persuasionPrincipleId → select dropdown
- explanation → textarea
</context>

<tasks>

<task type="auto">
  <name>Add optional title field to Annotation type</name>
  <files>src/types/annotations.ts</files>
  <action>
    Edit src/types/annotations.ts to add `title?: string` field to the Annotation interface.
    
    Place it BEFORE `explanation: string` (after persuasionPrincipleId).
    
    New structure:
    ```typescript
    export interface Annotation {
      lureId: string
      techniqueId: string
      persuasionPrincipleId?: string
      title?: string              // NEW: freetext title for annotation
      explanation: string
      createdAt: string
      annotationNumber?: number
      manualY?: number
    }
    ```
  </action>
  <verify>grep -n "title\?: string" src/types/annotations.ts</verify>
  <done>Annotation interface accepts optional title field</done>
</task>

<task type="auto">
  <name>Add title input field to AnnotationPanel</name>
  <files>src/components/AnnotationPanel.tsx</files>
  <action>
    Edit src/components/AnnotationPanel.tsx to add a title input field ABOVE the technique selector.
    
    Position: First thing inside the component, after the opening div.
    
    Structure:
    ```tsx
    <div className="annotation-section">
      <label htmlFor={`title-${lureId}`} className="annotation-label">
        Title (optional)
      </label>
      <input
        type="text"
        id={`title-${lureId}`}
        className="annotation-input"
        value={annotation?.title || ''}
        onChange={(e) => onUpdate({ title: e.target.value || undefined })}
        placeholder="Brief title for this lure..."
      />
    </div>
    ```
    
    The `onUpdate` handles setting to undefined when empty (auto-removes).
  </action>
  <verify>grep -n "title.*input\|title-\${lureId}" src/components/AnnotationPanel.tsx</verify>
  <done>AnnotationPanel shows title input field</done>
</task>

<task type="auto">
  <name>Verify title persists to LocalStorage</name>
  <files>src/utils/storage.ts</files>
  <action>
    Read src/utils/storage.ts. The saveAnnotations function uses JSON.stringify which automatically handles the new optional title field.
    
    No changes required - LocalStorage persistence works automatically for new fields.
    
    Verify by checking that loadAnnotations/saveAnnotations use Record<string, Annotation> type.
  </action>
  <verify>grep -n "Record<string, Annotation>" src/utils/storage.ts</verify>
  <done>Title field persists to LocalStorage via existing JSON serialization</done>
</task>

</tasks>

<verification>
# Phase 6 Plan 1 Verification

Run these commands to verify:

1. Type definition updated:
```bash
grep -n "title\?: string" src/types/annotations.ts
# Should output: `title?: string` on its own line
```

2. UI component has title input:
```bash
grep -n "title-\${lureId}\|title.*input" src/components/AnnotationPanel.tsx
# Should find title input element
```

3. Build passes:
```bash
npm run build 2>&1 | head -20
# Should complete without TypeScript errors
```
</verification>

<success_criteria>
- [ ] `title?: string` added to Annotation interface
- [ ] AnnotationPanel renders title input field
- [ ] Title persists to LocalStorage via JSON serialization
- [ ] Existing annotations (no title) work correctly
- [ ] Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-annotation-data-model/06-01-SUMMARY.md`
</output>
