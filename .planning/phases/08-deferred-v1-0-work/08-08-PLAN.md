---
phase: 08-deferred-v1-0-work
plan: 08
type: execute
wave: 3
depends_on: [08-05, 08-06]
files_modified:
  - src/components/library/TechniqueLibrary.tsx
  - src/App.tsx
  - src/index.css
autonomous: false

must_haves:
  truths:
    - "User can view all techniques (built-in and custom) in a library view"
    - "User can edit existing custom techniques"
    - "User can delete custom techniques"
    - "Built-in techniques are read-only (cannot edit or delete)"
    - "Annotations using deleted techniques show warning or fallback"
  artifacts:
    - path: "src/components/library/TechniqueLibrary.tsx"
      provides: "Library view for browsing and managing techniques"
      min_lines: 100
  key_links:
    - from: "src/components/library/TechniqueLibrary.tsx"
      to: "src/hooks/useCustomTechniques.ts"
      via: "Import for CRUD operations"
      pattern: "useCustomTechniques"
    - from: "src/App.tsx"
      to: "src/components/library/TechniqueLibrary.tsx"
      via: "Conditional rendering in settings or separate view"
      pattern: "TechniqueLibrary"
---

<objective>
Technique library view for managing custom techniques.

Purpose: Users can browse, edit, and delete their custom techniques in one place - essential for maintaining an organization-specific technique catalog.
Output: Full library view with search, filtering, edit, and delete capabilities.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/08-deferred-v1-0-work/08-DEFERRED-V1-0-WORK-RESEARCH.md

# Only reference prior plan SUMMARYs if genuinely needed
@.planning/phases/08-deferred-v1-0-work/08-05-SUMMARY.md
@.planning/phases/08-deferred-v1-0-work/08-06-SUMMARY.md
@src/components/library/CustomTechniqueEditor.tsx
@src/hooks/useCustomTechniques.ts
@src/data/techniques.json
@src/types/library.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TechniqueLibrary component</name>
  <files>src/components/library/TechniqueLibrary.tsx</files>
  <action>
    Create src/components/library/TechniqueLibrary.tsx for browsing and managing techniques:

    Props:
    - onClose: () => void (for modal/panel close)

    State:
    - searchQuery: string
    - filterTactic: string | 'all'
    - editingTechnique: CustomTechnique | null

    Display:
    - Search input for filtering by name or ID
    - Tactic dropdown filter (all tactics from techniques + custom tactics)
    - Two sections: "Built-in Techniques" (read-only) and "Custom Techniques" (editable)
    - Each technique card shows: ID, name, tactic, description
    - Custom technique cards have Edit and Delete buttons
    - Built-in technique cards show "View" button (opens MITRE URL)

    Actions:
    - Click Edit -> open CustomTechniqueEditor with technique data
    - Click Delete -> confirm dialog, then delete via hook
    - Click View -> open MITRE URL in new tab
    - "Create New Technique" button at top

    Search/filter logic:
    - Filter by searchQuery (name, ID, description)
    - Filter by selected tactic
    - Both filters apply together (AND logic)

    Reuse CustomTechniqueEditor for editing (pass editTechnique prop).
  </action>
  <verify>test -f src/components/library/TechniqueLibrary.tsx && grep -q "TechniqueLibrary" src/components/library/TechniqueLibrary.tsx</verify>
  <done>TechniqueLibrary component with browse, edit, delete capabilities</done>
</task>

<task type="auto">
  <name>Task 2: Handle deleted technique references in annotations</name>
  <files>src/App.tsx, src/components/AnnotationPanel.tsx</files>
  <action>
    Handle edge case where annotations reference deleted custom techniques:

    1. In AnnotationPanel, when rendering technique dropdown:
       - Check if annotation.techniqueId exists in available techniques
       - If not found, show warning: "Technique not found: {id}"
       - Allow user to select a different technique

    2. In AnnotationCard, when rendering technique tag:
       - If techniqueId not found in techniques, show "(Unknown Technique)" instead of crashing
       - Style with warning color (yellow/orange) to indicate issue

    3. Optional: Add cleanup utility to remove orphaned technique references

    This prevents broken UI when a custom technique is deleted but annotations still reference it.

    Do NOT auto-delete annotations with missing techniques - user may want to reassign them.
  </action>
  <verify>grep -q "Technique not found\|Unknown Technique" src/components/AnnotationPanel.tsx src/components/annotation/AnnotationCard.tsx</verify>
  <done>Annotation components handle missing techniques gracefully</done>
</task>

<task type="auto">
  <name>Task 3: Integrate TechniqueLibrary into app</name>
  <files>src/App.tsx</files>
  <action>
    Add TechniqueLibrary access point in the app:

    1. Add "Technique Library" button to:
       - ProjectSettings dropdown (recommended)
       - Or header in edit mode alongside other tools

    2. Add state for library modal/panel open/close

    3. When library opens:
       - Render TechniqueLibrary as modal
       - Pass useCustomTechniques hook for data access

    4. When library closes:
       - Refresh annotations to update any technique references

    Position: In ProjectSettings component, add a "Manage Techniques" button that opens the library modal.

    Do NOT add a separate tab or page - keep it as an overlay modal for consistent UX.
  </action>
  <verify>grep -q "TechniqueLibrary" src/App.tsx || grep -q "TechniqueLibrary" src/components/ProjectSettings.tsx</verify>
  <done>TechniqueLibrary accessible from ProjectSettings menu</done>
</task>

<task type="checkpoint:human-verify">
  <what-built>Complete technique library with browse, edit, delete, and orphan handling</what-built>
  <how-to-verify>
    1. Open ProjectSettings
    2. Click "Manage Techniques" or "Technique Library"
    3. Verify library modal opens with built-in and custom sections
    4. Test search: type "phishing" - verify results filter
    5. Test tactic filter: select "Initial Access" - verify results filter
    6. Create a custom technique via library
    7. Edit the custom technique - verify changes save
    8. Delete the custom technique - verify it's removed
    9. Create annotation using custom technique, then delete technique
    10. Verify annotation shows "Unknown Technique" warning instead of crashing
    11. Verify "View" button on built-in techniques opens MITRE URL
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues with library functionality or orphan handling</resume-signal>
</task>

</tasks>

<verification>
1. TechniqueLibrary modal opens from ProjectSettings
2. All techniques (built-in and custom) are displayed
3. Search and filter work correctly
4. Custom techniques can be edited and deleted
5. Built-in techniques are read-only (no edit/delete buttons)
6. Annotations with deleted technique references show warning
7. View button opens MITRE URLs in new tab
8. Create/Edit workflows work correctly
</verification>

<success_criteria>
- Users can manage their custom technique library
- Orphaned technique references handled gracefully
- Built-in techniques clearly distinguished from custom
- Search/filter makes large libraries navigable
- Edit and delete operations work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/08-deferred-v1-0-work/08-08-SUMMARY.md`
</output>
