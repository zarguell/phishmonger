---
phase: 13-compact-annotation-layout
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/utils/storage.ts
  - src/styles/layouts.module.css
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User preference for compact layout can be loaded from LocalStorage"
    - "User preference for compact layout can be saved to LocalStorage"
    - "Compact layout CSS variant applies smaller fonts (12px vs 14px) to annotations"
    - "Compact layout CSS variant uses tighter spacing (reduced padding and margins)"
    - "Compact layout maintains badge visibility and readability"
  artifacts:
    - path: "src/utils/storage.ts"
      provides: "loadCompactLayout and saveCompactLayout functions"
      exports: ["loadCompactLayout", "saveCompactLayout"]
    - path: "src/styles/layouts.module.css"
      provides: "compact-annotations CSS variant"
      contains: ".compact-annotations"
  key_links:
    - from: "loadCompactLayout()"
      to: "localStorage.getItem('phishmonger-compact-layout')"
      via: "Direct localStorage access with try-catch"
      pattern: "localStorage.getItem.*compact-layout"
    - from: "saveCompactLayout(enabled)"
      to: "localStorage.setItem('phishmonger-compact-layout', ...)"
      via: "Direct localStorage write with try-catch"
      pattern: "localStorage.setItem.*compact-layout"
---

<objective>
Add compact layout infrastructure: localStorage utilities for preference persistence and CSS variant for tighter annotation spacing.

Purpose: Enable users to toggle between standard and compact annotation layouts for different browsing scenarios (detailed review vs quick carousel scanning). The preference persists across sessions.

Output: Storage utilities (loadCompactLayout, saveCompactLayout) and compact-annotations CSS class in layouts.module.css.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/13-compact-annotation-layout/13-RESEARCH.md
@.planning/phases/12-detail-carousel/12-02-SUMMARY.md
@src/utils/storage.ts
@src/styles/layouts.module.css
@src/components/campaign/ReadOnlyEditor.tsx
</context>

<tasks>

<task type="auto">
  <name>Add localStorage utilities for compact layout preference</name>
  <files>src/utils/storage.ts</files>
  <action>
    Add to src/utils/storage.ts:

    1. Define COMPACT_LAYOUT_KEY constant:
       ```typescript
       const COMPACT_LAYOUT_KEY = 'phishmonger-compact-layout'
       ```

    2. Add loadCompactLayout() function:
       - Returns boolean (false by default when no saved value)
       - Uses try-catch for error handling
       - Returns saved === 'true' when value exists
       - Logs error to console on failure

    3. Add saveCompactLayout(enabled: boolean) function:
       - Accepts boolean parameter
       - Stores as string 'true' or 'false'
       - Uses try-catch for error handling
       - Logs error to console on failure

    Follow existing storage.ts patterns: use const KEY at top, export functions, try-catch with console.error. Do NOT use useLocalStorage library - direct localStorage calls are simpler for a boolean flag.
  </action>
  <verify>
    Run `npm run build` - TypeScript compiles without errors. Check that loadCompactLayout and saveCompactLayout are exported functions.
  </verify>
  <done>
    loadCompactLayout() returns boolean from localStorage (default false), saveCompactLayout(enabled) writes to localStorage. Both have error handling.
  </done>
</task>

<task type="auto">
  <name>Add compact-annotations CSS variant to layouts.module.css</name>
  <files>src/styles/layouts.module.css</files>
  <action>
    Add to src/styles/layouts.module.css (after existing .compact styles):

    Create .compact-annotations variant with:
    - Gap: 16px (reduced from default 24px in annotation-column)
    - Padding: 24px (reduced from 40px)
    - .annotation-card padding: 8px (reduced from 12px)
    - .annotation-title font-size: 14px (reduced from ~15px/1.1em)
    - .annotation-title margin-bottom: 6px (reduced from 8px)
    - .annotation-title padding-left: 24px (reduced from 30px)
    - .annotation-tags margin-bottom: 6px (reduced from 8px)
    - .mitre-tag, .persuasion-tag font-size: 11px (reduced from ~13px/0.85em)
    - .mitre-tag, .persuasion-tag padding: 1px 5px (reduced from 2px 6px)
    - .annotation-description font-size: 12px (reduced from default ~16px)
    - .annotation-description line-height: 1.4 (reduced from 1.6)
    - .arrow-badge width/height: 18px (reduced from 20px)
    - .arrow-badge font-size: 10px (reduced from 11px)

    Use :global() selectors for annotation component classes (annotation-card, annotation-title, etc.) since layouts.module.css is a CSS Module but annotation components use global classes.

    Do NOT modify existing .compact layout - this is a separate variant focused on annotations only.
  </action>
  <verify>
    Run `npm run build` - CSS compiles without errors. Inspect compiled CSS or browser DevTools to confirm .compact-annotations class exists with child selectors.
  </verify>
  <done>
    .compact-annotations class exists with all spacing reductions (16px gap, 24px padding, smaller fonts). Class can be applied to SlideWrapper parent element.
  </done>
</task>

</tasks>

<verification>
1. Storage utilities compile and export correctly
2. CSS variant exists in compiled output
3. No TypeScript errors
4. CSS follows :global() pattern for component classes
</verification>

<success_criteria>
1. loadCompactLayout() returns false by default, returns saved value when exists
2. saveCompactLayout(true) stores 'true' in localStorage
3. .compact-annotations CSS class reduces font sizes to 12px and spacing to 16px gap
4. Minimum font size of 12px maintains readability (per ROADMAP success criteria)
</success_criteria>

<output>
After completion, create `.planning/phases/13-compact-annotation-layout/13-01-SUMMARY.md`
</output>
