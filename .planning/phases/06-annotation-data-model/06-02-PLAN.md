---
phase: 06-annotation-data-model
plan: 06-02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/annotations.ts
  - src/components/AnnotationPanel.tsx
  - src/components/AnnotationCard.tsx
autonomous: true
must_haves:
  truths:
    - "User can create annotations without selecting a MITRE technique"
    - "MITRE tag displays in format 'T1598 - Phishing for Information'"
    - "Tag can be cleared/removed from annotation"
  artifacts:
    - path: src/types/annotations.ts
      provides: "Optional techniqueId field"
      contains: "techniqueId\\?: string"
    - path: src/components/AnnotationCard.tsx
      provides: "MITRE tag display component"
      contains: "T[0-9].* - .*"
  key_links:
    - from: src/components/AnnotationPanel.tsx
      to: src/data/techniques.json
      via: "techniqueId selected from dropdown"
      pattern: "techniqueId.*value|onChange.*techniqueId"
    - from: src/components/AnnotationCard.tsx
      to: src/types/annotations.ts
      via: "techniqueId used for tag display"
      pattern: "techniqueId|T[0-9]"
---

<objective>
Make MITRE ATT&CK technique optional and add formatted tag display. Enables annotations with just a title/persuasion, no technique required (ANN-10).
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md

# Current state (src/types/annotations.ts):
```typescript
export interface Annotation {
  lureId: string
  techniqueId: string            // REQUIRED - needs to become optional
  persuasionPrincipleId?: string
  title?: string
  explanation: string
  // ...
}
```

# Technique data format (src/data/techniques.json):
```json
{
  "id": "T1598",
  "name": "Phishing for Information",
  "tactic": "Resource Development",
  ...
}
```

# Tag display format per requirements:
```
(T1598 - Phishing for Information)
```

The visualizer card layout per ANN-12:
- Line 1: Title (bold)
- Line 2: Tags inline (MITRE and Persuasion)
- Line 3: Full description
</context>

<tasks>

<task type="auto">
  <name>Make techniqueId optional in Annotation type</name>
  <files>src/types/annotations.ts</files>
  <action>
    Edit src/types/annotations.ts to change `techniqueId: string` to `techniqueId?: string`.
    
    This makes MITRE technique selection optional per ANN-10 requirements.
    
    After change:
    ```typescript
    export interface Annotation {
      lureId: string
      techniqueId?: string        // CHANGED: now optional
      persuasionPrincipleId?: string
      title?: string
      explanation: string
      createdAt: string
      annotationNumber?: number
      manualY?: number
    }
    ```
  </action>
  <verify>grep -n "techniqueId\?: string" src/types/annotations.ts</verify>
  <done>techniqueId field is optional in Annotation type</done>
</task>

<task type="auto">
  <name>Update AnnotationPanel technique selector for optional value</name>
  <files>src/components/AnnotationPanel.tsx</files>
  <action>
    Edit src/components/AnnotationPanel.tsx to update the technique selector.
    
    Current code likely uses:
    ```tsx
    value={annotation?.techniqueId || ''}
    ```
    
    This should already work correctly since `|| ''` handles undefined.
    
    No changes required if the existing code uses optional chaining correctly.
    
    Verify the technique selector allows clearing (empty option at top).
  </action>
  <verify>grep -n "technique.*select\|Select technique" src/components/AnnotationPanel.tsx</verify>
  <done>Technique selector allows empty/cleared value</done>
</task>

<task type="auto">
  <name>Create MITRE tag display component</name>
  <files>src/components/AnnotationCard.tsx</files>
  <action>
    Create new file src/components/AnnotationCard.tsx with MITRE tag display.
    
    This component will display an annotation card for the visualizer with:
    1. Title (bold, if present)
    2. Tags inline on second line
    3. Description below
    
    MITRE tag format: `(T1598 - Phishing for Information)`
    
    ```typescript
    import techniques from '../data/techniques.json'
    import type { Annotation } from '../types/annotations'
    
    interface AnnotationCardProps {
      annotation: Annotation
    }
    
    function getTechniqueName(id: string): string {
      const technique = techniques.find(t => t.id === id)
      return technique ? `${technique.id} - ${technique.name}` : id
    }
    
    export function AnnotationCard({ annotation }: AnnotationCardProps) {
      return (
        <div className="annotation-card">
          {annotation.title && (
            <div className="annotation-title">{annotation.title}</div>
          )}
          <div className="annotation-tags">
            {annotation.techniqueId && (
              <span className="mitre-tag">
                ({getTechniqueName(annotation.techniqueId)})
              </span>
            )}
          </div>
          <div className="annotation-description">
            {annotation.explanation}
          </div>
        </div>
      )
    }
    ```
    
    Place in src/components/ directory (same level as AnnotationPanel.tsx).
  </action>
  <verify>test -f src/components/AnnotationCard.tsx && grep -n "T.* - .*\|getTechniqueName" src/components/AnnotationCard.tsx</verify>
  <done>AnnotationCard component created with MITRE tag display</done>
</task>

</tasks>

<verification>
# Phase 6 Plan 2 Verification

Run these commands to verify:

1. Type definition updated:
```bash
grep -n "techniqueId\?: string" src/types/annotations.ts
# Should output optional version
```

2. AnnotationCard created:
```bash
test -f src/components/AnnotationCard.tsx && echo "File exists"
grep -n "T[0-9].* - .*" src/components/AnnotationCard.tsx
# Should find tag format
```

3. Build passes:
```bash
npm run build 2>&1 | head -20
```
</verification>

<success_criteria>
- [ ] techniqueId field is optional in Annotation type
- [ ] AnnotationPanel allows clearing technique selection
- [ ] AnnotationCard component created with MITRE tag display
- [ ] Tag format is "(T1598 - Phishing for Information)"
- [ ] Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-annotation-data-model/06-02-SUMMARY.md`
</output>
