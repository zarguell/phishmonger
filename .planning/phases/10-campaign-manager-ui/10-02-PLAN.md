---
phase: 10-campaign-manager-ui
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - src/components/campaign/CampaignManager.tsx
autonomous: true

must_haves:
  truths:
    - "User can view list of all campaigns in modal"
    - "User sees empty state with educational message when no campaigns exist"
    - "User can create new campaign via button in CampaignManager header"
    - "User can import campaign from JSON file"
    - "User can click Edit button to open campaign editor"
    - "User can click Delete button to remove campaign (via confirm dialog)"
    - "User can click Export button to download campaign JSON"
    - "Modal closes when clicking backdrop"
  artifacts:
    - path: "src/components/campaign/CampaignManager.tsx"
      provides: "Campaign list modal with CRUD actions"
      exports: ["CampaignManager"]
      min_lines: 120
  key_links:
    - from: "CampaignManager.tsx"
      to: "src/components/campaign/CampaignCard.tsx"
      via: "import CampaignCard"
      pattern: "import.*CampaignCard.*from"
    - from: "CampaignManager.tsx"
      to: "src/hooks/useCampaigns.ts"
      via: "useCampaigns hook for CRUD operations"
      pattern: "useCampaigns.*addCampaign|deleteCampaign"
    - from: "CampaignManager.tsx"
      to: "src/types/campaign.ts"
      via: "Campaign type reference"
      pattern: "import.*Campaign.*from.*campaign"
---

<objective>
Build the CampaignManager modal - the main entry point for campaign management showing a grid of campaign cards with create, import, and bulk actions.

Purpose: Provides the primary campaign management interface where users can view all campaigns, create new ones, import existing campaigns, and access individual campaign editing.

Output: CampaignManager modal component with campaign grid, empty state, create/import buttons, and campaign CRUD operations wired through useCampaigns hook.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-campaign-manager-ui/10-RESEARCH.md
@.planning/phases/10-campaign-manager-ui/10-CONTEXT.md
@.planning/phases/10-campaign-manager-ui/10-01-SUMMARY.md

@src/types/campaign.ts
@src/hooks/useCampaigns.ts
@src/components/library/TechniqueLibrary.tsx
@src/components/ProjectSettings.tsx
@src/utils/storage.ts
@src/components/campaign/CampaignCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Create CampaignManager modal with campaign grid and header</name>
  <files>src/components/campaign/CampaignManager.tsx</files>
  <action>
    Create CampaignManager component following TechniqueLibrary.tsx modal pattern:

    Props interface:
    - isOpen: boolean
    - onClose: () => void
    - onEditCampaign: (campaign: Campaign) => void (callback to open editor)
    - currentProject?: Phish (for "add current project" quick action - optional for this plan)

    Modal structure (following TechniqueLibrary pattern):
    - Fixed overlay: position fixed, inset 0, bg-black/50, z-50
    - Container: centered, max-w-6xl, max-h-[90vh], overflow-y-auto
    - Header: "Campaigns" title + close button (Ã—)
    - Filter bar: Search input + "Create New Campaign" button + "Import" button
    - Content area: Campaign grid or empty state

    Campaign grid:
    - CSS Grid: grid-cols-1 md:grid-cols-2 lg:grid-cols-3, gap-4
    - Map through campaigns array, render CampaignCard for each
    - Pass callbacks: onEdit, onDelete, onExport

    Empty state (when campaigns.length === 0):
    - Centered container with padding
    - Icon or emoji (e.g., folder emoji)
    - "No campaigns yet" heading
    - Description: "Create campaigns to organize your phishing exercises"
    - "Create your first campaign" button (same as Create New Campaign)

    DO NOT add filtering/sorting beyond search - defer to future phase.
  </action>
  <verify>
    File exists at src/components/campaign/CampaignManager.tsx with:
    - CampaignManager component exported
    - Modal overlay following TechniqueLibrary pattern
    - Campaign grid with responsive layout
    - Empty state with educational message
    - Header with title and close button
  </verify>
  <done>
    CampaignManager modal displays campaign grid or empty state. Header contains title, close button, search, and action buttons.
  </done>
</task>

<task type="auto">
  <name>Wire up campaign CRUD operations with useCampaigns hook</name>
  <files>src/components/campaign/CampaignManager.tsx</files>
  <action>
    Add campaign management logic to CampaignManager:

    State:
    - campaigns from useCampaigns()
    - searchQuery state for filter input
    - importError state for JSON import failures

    Filtered campaigns:
    - useMemo to filter campaigns by searchQuery
    - Search matches: name, description (case-insensitive)
    - Show all campaigns when searchQuery is empty

    Create campaign:
    - "Create New Campaign" button calls onCreateNew callback
    - This callback should be passed from parent (App.tsx)
    - For now, button existence is sufficient - wiring done in plan 10-04

    Delete campaign:
    - CampaignCard onDelete triggers confirm dialog
    - Use window.confirm("Delete '{campaign.name}'? This action cannot be undone.")
    - On confirm: call deleteCampaign(campaign.id) from useCampaigns
    - Use confirm dialog (not type-to-confirm) - simpler UX for list view

    Export campaign:
    - CampaignCard onExport triggers JSON download
    - Stringify campaign with JSON.stringify(campaign, null, 2)
    - Create Blob with type 'application/json'
    - Use URL.createObjectURL + hidden anchor element
    - Filename: `${campaign.name.replace(/[^a-z0-9]/gi, '-').toLowerCase()}.json`
    - Revoke URL after download
    - Pattern: Follow ProjectSettings.tsx exportProjectJSON

    Import campaign (file-based):
    - Hidden file input: accept=".json", type="file"
    - Trigger file picker when "Import" button clicked
    - FileReader to read file as text
    - JSON.parse with try-catch for error handling
    - Validate structure: check for id, name, description, campaignPhishes
    - Check for duplicate ID (campaigns.some(c => c.id === imported.id))
    - If duplicate: generate new ID with crypto.randomUUID(), append " (copy)" to name
    - Call addCampaign(imported) from useCampaigns
    - Show error message if import fails (inline text below import button)

    Backdrop click handler:
    - onClick on backdrop div checks e.target === e.currentTarget
    - Calls onClose() to close modal
  </action>
  <verify>
    CampaignManager has:
    - useCampaigns hook imported and used
    - Search filtering working on campaigns array
    - Delete with confirm dialog
    - Export downloading JSON file
    - Import reading file and creating campaign
    - Duplicate detection on import (new ID + " (copy)" suffix)
    - Backdrop click-to-close
  </verify>
  <done>
    Campaign CRUD operations fully functional. User can create (via callback), delete (with confirm), export (JSON download), and import (file upload with duplicate handling). Search filters campaigns by name/description.
  </done>
</task>

<task type="auto">
  <name>Add "Create New Campaign" quick-create modal</name>
  <files>src/components/campaign/CampaignManager.tsx</files>
  <action>
    Add inline form modal for quick campaign creation (minimal: name + description only):

    State:
    - showCreateModal: boolean
    -createForm: { name: string, description: string }
    - createErrors: { name?: string }

    Modal structure (nested inside main modal when showCreateModal is true):
    - Position: fixed, z-50 (higher than parent)
    - Backdrop: bg-black/50
    - Content: centered white div, max-w-md, padding
    - Header: "Create New Campaign" + close button
    - Form: Name input (required), Description textarea (optional)
    - Actions: Cancel button, Create button (disabled if name empty)

    Form validation:
    - Name is required (trim() check)
    - Show error below name input if empty
    - Disable Create button while invalid

    On submit:
    - Call addCampaign({ name, description, campaignPhishes: [] })
    - Clear form
    - Close modal
    - New campaign appears in grid

    Follow CustomTechniqueEditor.tsx form pattern for validation and error display.
  </action>
  <verify>
    CampaignManager has:
    - showCreateModal state
    - Inline create form with name and description fields
    - Validation (name required)
    - Create button that calls addCampaign
    - Form clears and closes after creation
  </verify>
  <done>
    Quick-create modal allows creating new campaigns with name and description. Created campaign appears in grid immediately.
  </done>
</task>

</tasks>

<verification>
1. CampaignManager modal opens/closes correctly
2. Campaign grid displays all campaigns with CampaignCard components
3. Empty state shows when no campaigns exist
4. Search filter works on campaign names and descriptions
5. Create modal opens, validates, and creates campaigns
6. Delete shows confirm dialog and removes campaign
7. Export downloads campaign JSON file
8. Import reads file, validates for duplicates, and creates campaign
9. Backdrop click closes modal
10. All operations use useCampaigns hook correctly
</verification>

<success_criteria>
1. CampaignManager displays all campaigns in responsive grid layout
2. Empty state provides clear next step (create campaign)
3. Search filters campaigns in real-time
4. Quick-create form makes campaign creation fast
5. Delete operation requires confirmation
6. Export produces valid JSON file with campaign data
7. Import handles duplicate IDs by generating new ID + " (copy)" suffix
8. Modal follows existing UX patterns from TechniqueLibrary
</success_criteria>

<output>
After completion, create `.planning/phases/10-campaign-manager-ui/10-02-SUMMARY.md`
</output>
