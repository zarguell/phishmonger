---
phase: 04-nist-phish-scale-scoring
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/scoring.ts
  - src/utils/scoring.ts
  - src/components/ScoringPanel.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can increment/decrement visual cues counter with +/- buttons"
    - "User can increment/decrement language cues counter with +/- buttons"
    - "User can slide premise alignment slider (1-5 scale)"
    - "Scoring panel displays full calculation breakdown (premise alignment, cues, difficulty)"
    - "Difficulty badge shows correct letter (E/M/H) based on calculation"
  artifacts:
    - path: "src/types/scoring.ts"
      provides: "ScoringData interface, DifficultyLevel type"
      exports: ["ScoringData", "DifficultyLevel"]
    - path: "src/utils/scoring.ts"
      provides: "NIST Phish Scale calculation logic"
      exports: ["calculateDifficulty", "getDifficultyBadge"]
    - path: "src/components/ScoringPanel.tsx"
      provides: "Scoring input controls with counter widgets and slider"
      min_lines: 80
  key_links:
    - from: "src/components/ScoringPanel.tsx"
      to: "src/utils/scoring.ts"
      via: "import calculateDifficulty, getDifficultyBadge"
      pattern: "import.*scoring"
    - from: "src/components/ScoringPanel.tsx"
      to: "src/types/scoring.ts"
      via: "import ScoringData, DifficultyLevel"
      pattern: "import.*ScoringData"
---

<objective>
Create scoring data types, NIST Phish Scale calculation utility, and ScoringPanel component with counter widgets and premise alignment slider.

Purpose: Implement the core scoring logic and UI controls for calculating phishing difficulty using NIST methodology.
Output: Type definitions, calculation utility, and complete ScoringPanel component ready for App integration.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-nist-phish-scale-scoring/04-CONTEXT.md
@src/types/annotations.ts
@src/components/AnnotationPanel.tsx
@src/index.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create scoring types and NIST calculation utility</name>
  <files>src/types/scoring.ts, src/utils/scoring.ts</files>
  <action>
    Create scoring type definitions:

    **src/types/scoring.ts:**
    ```typescript
    /**
     * NIST Phish Scale scoring data
     * Based on NIST Special Publication 800-53
     */
    export interface ScoringData {
      visualCues: number           // Count of visual cues (logo pixelation, etc.)
      languageCues: number         // Count of language cues (grammar errors, etc.)
      premiseAlignment: number     // Premise alignment 1-5 Likert scale
    }

    /**
     * Difficulty level derived from NIST Phish Scale
     * Formula: Premise Alignment - (Visual Cues + Language Cues)
     * - Easy: >= 3
     * - Moderate: 1-2
     * - Hard: <= 0
     */
    export type DifficultyLevel = 'easy' | 'moderate' | 'hard'

    /**
     * Difficulty badge display data
     */
    export interface DifficultyBadge {
      letter: 'E' | 'M' | 'H'
      color: string
      label: string
    }
    ```

    **src/utils/scoring.ts:**
    ```typescript
    import type { ScoringData, DifficultyLevel, DifficultyBadge } from '../types/scoring'

    /**
     * Calculates NIST Phish Scale difficulty score
     * Formula: Premise Alignment - (Visual Cues + Language Cues)
     *
     * @param scoring - Input scoring data
     * @returns Numeric difficulty score
     */
    export function calculateDifficulty(scoring: ScoringData): number {
      const { visualCues, languageCues, premiseAlignment } = scoring
      const totalCues = visualCues + languageCues
      return premiseAlignment - totalCues
    }

    /**
     * Determines difficulty level from numeric score
     * - Easy: >= 3
     * - Moderate: 1-2
     * - Hard: <= 0
     *
     * @param score - Numeric difficulty score
     * @returns Difficulty level
     */
    export function getDifficultyLevel(score: number): DifficultyLevel {
      if (score >= 3) return 'easy'
      if (score >= 1) return 'moderate'
      return 'hard'
    }

    /**
     * Gets badge display data for difficulty level
     *
     * @param level - Difficulty level
     * @returns Badge display object
     */
    export function getDifficultyBadge(level: DifficultyLevel): DifficultyBadge {
      const badges: Record<DifficultyLevel, DifficultyBadge> = {
        easy: { letter: 'E', color: '#22c55e', label: 'Easy' },
        moderate: { letter: 'M', color: '#eab308', label: 'Moderate' },
        hard: { letter: 'H', color: '#ef4444', label: 'Hard' }
      }
      return badges[level]
    }
    ```

    Do NOT create test files (this is not a TDD plan).
    Follow existing patterns: types in src/types/, utilities in src/utils/.
  </action>
  <verify>
    Check files exist:
    - ls -la src/types/scoring.ts
    - ls -la src/utils/scoring.ts

    Verify TypeScript compiles:
    - npm run build (should have no type errors)
  </verify>
  <done>
    src/types/scoring.ts exports ScoringData, DifficultyLevel, DifficultyBadge
    src/utils/scoring.ts exports calculateDifficulty, getDifficultyLevel, getDifficultyBadge
    All type definitions match NIST Phish Scale formula
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ScoringPanel component with counter widgets and slider</name>
  <files>src/components/ScoringPanel.tsx</files>
  <action>
    Create ScoringPanel component with input controls:

    **src/components/ScoringPanel.tsx:**
    ```typescript
    import { useState, useRef } from 'react'
    import type { ScoringData, DifficultyLevel, DifficultyBadge } from '../types/scoring'
    import { calculateDifficulty, getDifficultyLevel, getDifficultyBadge } from '../utils/scoring'

    interface ScoringPanelProps {
      scoring: ScoringData
      onUpdate: (updates: Partial<ScoringData>) => void
    }

    export function ScoringPanel({ scoring, onUpdate }: ScoringPanelProps) {
      const [hasInteracted, setHasInteracted] = useState(false)
      const score = calculateDifficulty(scoring)
      const difficulty = getDifficultyLevel(score)
      const badge = getDifficultyBadge(difficulty)

      // Counter widget component
      const Counter = ({ value, label, onChange }: { value: number, label: string, onChange: (val: number) => void }) => (
        <div className="counter-widget">
          <label className="counter-label">{label}</label>
          <div className="counter-controls">
            <button
              type="button"
              className="counter-btn counter-btn-decrement"
              onClick={() => onChange(Math.max(0, value - 1))}
              aria-label={`Decrement ${label}`}
            >
              âˆ’
            </button>
            <span className="counter-value">{value}</span>
            <button
              type="button"
              className="counter-btn counter-btn-increment"
              onClick={() => onChange(value + 1)}
              aria-label={`Increment ${label}`}
            >
              +
            </button>
          </div>
        </div>
      )

      return (
        <div className="scoring-panel">
          <h2>NIST Phish Scale</h2>

          {/* Score Display */}
          <div className="score-display">
            <div className="score-badge" style={{ backgroundColor: badge.color }}>
              {badge.letter}
            </div>
            <div className="score-breakdown">
              <div className="score-row">
                <span>Premise Alignment:</span>
                <strong>{scoring.premiseAlignment}</strong>
              </div>
              <div className="score-row">
                <span>Visual Cues:</span>
                <strong>-{scoring.visualCues}</strong>
              </div>
              <div className="score-row">
                <span>Language Cues:</span>
                <strong>-{scoring.languageCues}</strong>
              </div>
              <div className="score-row score-total">
                <span>Difficulty:</span>
                <strong>{score}</strong>
              </div>
            </div>
          </div>

          {/* Input Controls */}
          <div className="scoring-controls">
            <Counter
              label="Visual Cues"
              value={scoring.visualCues}
              onChange={(val) => onUpdate({ visualCues: val })}
            />

            <Counter
              label="Language Cues"
              value={scoring.languageCues}
              onChange={(val) => onUpdate({ languageCues: val })}
            />

            <div className="slider-widget">
              <label className="slider-label">Premise Alignment</label>
              <div className="slider-controls">
                <input
                  type="range"
                  min="1"
                  max="5"
                  step="1"
                  value={scoring.premiseAlignment}
                  onChange={(e) => onUpdate({ premiseAlignment: Number(e.target.value) }}
                  className="premise-slider"
                  aria-label="Premise alignment"
                />
                <div className="slider-value">{scoring.premiseAlignment}</div>
              </div>
              <div className="slider-labels">
                <span>Low (1)</span>
                <span>High (5)</span>
              </div>
            </div>
          </div>
        </div>
      )
    }
    ```

    Follow existing patterns from AnnotationPanel.tsx for component structure and className conventions.
    Use prominent +/- buttons (not subtle stepper arrows).
    Display score breakdown at TOP of panel (not bottom).
  </action>
  <verify>
    Check component exists:
    - ls -la src/components/ScoringPanel.tsx

    Verify TypeScript compiles:
    - npm run build (no type errors)
  </verify>
  <done>
    ScoringPanel component renders with:
    - Two counter widgets (Visual Cues, Language Cues) with prominent +/- buttons
    - Slider for premise alignment (1-5 scale) with Low/High labels
    - Score display at top showing full breakdown
    - Difficulty badge (E/M/H) with correct color based on calculation
  </done>
</task>

<task type="auto">
  <name>Task 3: Add ScoringPanel CSS styles</name>
  <files>src/index.css</files>
  <action>
    Add ScoringPanel styles to src/index.css (append at end of file):

    ```css
    /* Scoring Panel Styles */
    .scoring-panel {
      padding: 1rem;
      background: white;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .scoring-panel h2 {
      margin: 0 0 1rem 0;
      font-size: 1.25rem;
      color: #333;
    }

    .score-display {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      background: #f9fafb;
      border-radius: 4px;
      margin-bottom: 1.5rem;
      align-items: center;
    }

    .score-badge {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: bold;
      color: white;
      flex-shrink: 0;
    }

    .score-breakdown {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .score-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.875rem;
    }

    .score-total {
      border-top: 1px solid #ddd;
      padding-top: 0.25rem;
      margin-top: 0.25rem;
      font-weight: bold;
    }

    .scoring-controls {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .counter-widget {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .counter-label {
      font-weight: 500;
      font-size: 0.875rem;
      color: #333;
    }

    .counter-controls {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .counter-btn {
      width: 40px;
      height: 40px;
      border: 2px solid #ccc;
      border-radius: 4px;
      background: white;
      font-size: 1.5rem;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      transition: all 0.15s ease;
    }

    .counter-btn:hover:not(:disabled) {
      background: #f5f5f5;
      border-color: #999;
    }

    .counter-btn:active:not(:disabled) {
      background: #e5e5e5;
      transform: scale(0.95);
    }

    .counter-value {
      width: 40px;
      text-align: center;
      font-size: 1.25rem;
      font-weight: bold;
    }

    .slider-widget {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .slider-label {
      font-weight: 500;
      font-size: 0.875rem;
      color: #333;
    }

    .slider-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .premise-slider {
      flex: 1;
      height: 8px;
      border-radius: 4px;
      background: #ddd;
      outline: none;
      cursor: pointer;
    }

    .slider-value {
      width: 30px;
      text-align: center;
      font-size: 1.25rem;
      font-weight: bold;
    }

    .slider-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: #666;
    }
    ```

    Follow existing CSS patterns from index.css (font sizes, colors, spacing).
    Use flexbox for layouts (no absolute positioning).
    Make counter buttons prominent and touch-friendly (40px minimum).
  </action>
  <verify>
    Check styles added:
    - grep -A 5 "scoring-panel" src/index.css

    Verify CSS compiles:
    - npm run build (no CSS errors)
  </verify>
  <done>
    ScoringPanel styles added to index.css with:
    - Prominent counter buttons (40px, bold +/-)
    - Circle badge (60px) with E/M/H letter
    - Score breakdown display
    - Slider with Low/High labels
    - Consistent with existing UI patterns
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Verify TypeScript compiles: `npm run build` (no type errors)
2. Verify component structure: `ls -la src/components/ScoringPanel.tsx` exists
3. Verify utility exports: `grep -r "export.*calculateDifficulty" src/utils/scoring.ts`
4. Check counter widgets render (manual visual check in browser after App integration in plan 02)
</verification>

<success_criteria>
1. src/types/scoring.ts defines ScoringData, DifficultyLevel, DifficultyBadge
2. src/utils/scoring.ts exports calculateDifficulty, getDifficultyLevel, getDifficultyBadge
3. src/components/ScoringPanel.tsx renders counter widgets and slider
4. ScoringPanel displays score breakdown at top with badge
5. Component follows existing patterns (similar to AnnotationPanel)
6. All TypeScript types compile without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-nist-phish-scale-scoring/04-01-SUMMARY.md`
</output>
