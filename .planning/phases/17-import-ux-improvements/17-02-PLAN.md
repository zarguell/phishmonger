---
phase: 17-import-ux-improvements
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/import/CampaignImportModal.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - User opens campaign import modal from CampaignManager
    - Modal closes with Escape key or backdrop click
    - User imports campaign via file upload
    - User imports campaign via text paste
    - Invalid JSON shows inline error message
    - Duplicate campaign ID generates new ID with "(copy)" suffix
  artifacts:
    - path: "src/components/import/CampaignImportModal.tsx"
      provides: "Campaign import modal with file + text input"
      min_lines: 100
      exports: ["CampaignImportModal"]
  key_links:
    - from: "src/components/import/CampaignImportModal.tsx"
      to: "src/hooks/useCampaigns.ts"
      via: "addCampaign function"
      pattern: "addCampaign"
    - from: "src/components/import/CampaignImportModal.tsx"
      to: "src/components/shortcuts/KeyboardShortcutHelp.tsx"
      via: "modal pattern (escape key + backdrop click)"
      pattern: "useEffect.*keydown.*Escape"
    - from: "src/components/import/CampaignImportModal.tsx"
      to: "src/components/campaign/CampaignManager.tsx"
      via: "duplicate ID handling pattern (lines 101-105)"
      pattern: "crypto\.randomUUID"
---

<objective>
Create CampaignImportModal component - modal dialog for importing campaigns with dual input methods

Purpose: Replace hidden file input in CampaignManager with a modal dialog supporting both file upload and text paste import methods
Output: New CampaignImportModal component with escape key support, backdrop click handling, JSON validation, and duplicate ID handling
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/shortcuts/KeyboardShortcutHelp.tsx
@src/components/campaign/CampaignManager.tsx
@src/hooks/useCampaigns.ts
@src/types/campaign.ts
</context>

<tasks>

<task type="auto">
  <name>Create CampaignImportModal component with dual input</name>
  <files>src/components/import/CampaignImportModal.tsx</files>
  <action>
Create new modal component at src/components/import/CampaignImportModal.tsx:

**Interface:**
```typescript
interface CampaignImportModalProps {
  isOpen: boolean;
  onClose: () => void;
  onImport: (campaign: CampaignInput) => void;
  existingCampaigns: Campaign[]; // For duplicate ID detection
}
```

**Modal Pattern (copy from KeyboardShortcutHelp.tsx lines 11-29):**
- useEffect for Escape key handling (addEventListener 'keydown', check event.key === 'Escape')
- handleBackdropClick function: check if event.target === event.currentTarget, then call onClose()
- Return null if !isOpen

**Layout (follow KeyboardShortcutHelp modal style):**
- Fixed backdrop with rgba(0, 0, 0, 0.5) background, zIndex 1000
- White content div with borderRadius 8px, boxShadow, maxWidth 500px
- Header with title "Import Campaign" and close button (Ã—)
- Stacked layout for two input methods:
  1. File upload: hidden file input, styled button "Upload JSON file"
  2. Text paste: textarea with placeholder "Paste campaign JSON here..."
  3. Import button (enabled when valid input present)
  4. Cancel button

**Import Logic (reuse CampaignManager pattern lines 87-122):**
- File handler: await file.text(), JSON.parse, validate structure
- Text handler: Direct JSON.parse, validate structure
- Validation: Check id, name, description (string), campaignPhishes (array)
- Duplicate handling: If ID exists in existingCampaigns, generate new ID with crypto.randomUUID() and append " (copy)" to name
- On success: Call onImport(campaignData), call onClose(), clear all state
- On error: setImportError(message), show inline error below input

**State Management:**
- importError: string | null (for validation failures)
- importText: string (for text paste input)
- fileInputRef: useRef<HTMLInputElement> (for file input)

**IMPORTANT:**
- Reset file input value after processing (fileInputRef.current.value = '')
- Clear all state when modal closes (useEffect on isOpen change)
- Show specific error messages (don't just say "Import failed")
- Validate campaign structure: id, name, typeof description === 'string', Array.isArray(campaignPhishes)
- Use existingCampaigns prop for duplicate detection (compare parsed.id to existing c.id)

Use inline styles (matching KeyboardShortcutHelp pattern), NOT CSS modules or styled-components.
  </action>
  <verify>
Check file exists at src/components/import/CampaignImportModal.tsx with:
- Interface CampaignImportModalProps defined with existingCampaigns prop
- useEffect for Escape key handling present
- handleBackdropClick function present
- File and text input handlers present
- Campaign structure validation present
- Duplicate ID handling using crypto.randomUUID()
- Error state handling present
- Export statement: export function CampaignImportModal(...)
  </verify>
  <done>
CampaignImportModal component exists with:
- Modal open/close behavior
- Escape key closes modal
- Backdrop click closes modal
- File upload imports valid campaign JSON
- Text paste imports valid campaign JSON
- Invalid JSON shows error message
- Duplicate ID generates new ID with "(copy)" suffix
- All state resets on close
  </done>
</task>

</tasks>

<verification>
- Component compiles without TypeScript errors
- Modal follows KeyboardShortcutHelp pattern (escape key + backdrop click)
- Both file upload and text paste methods work
- Campaign JSON validation catches invalid input
- Duplicate campaign IDs are handled correctly
- Error messages are user-friendly
</verification>

<success_criteria>
CampaignImportModal component created and ready for integration into App.tsx
</success_criteria>

<output>
After completion, create `.planning/phases/17-import-ux-improvements/17-02-SUMMARY.md`
</output>
