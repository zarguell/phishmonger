---
phase: 11-ical-export-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/utils/icalExport.ts
autonomous: true
must_haves:
  truths:
    - "ical-generator library is installed and available in node_modules"
    - "generateCampaignICal function creates RFC 5545 compliant .ics content"
    - "downloadCampaignICal function triggers browser download of .ics file"
    - "Each scheduled phish becomes a separate VEVENT with proper UID"
    - "Event title format is 'Campaign Name: Phish Title'"
    - "Events use UTC times at 9:00 AM to avoid timezone complexity"
  artifacts:
    - path: "package.json"
      contains: "ical-generator"
    - path: "src/utils/icalExport.ts"
      provides: "iCal generation and download utilities"
      exports: ["generateCampaignICal", "downloadCampaignICal"]
      min_lines: 30
  key_links:
    - from: "src/utils/icalExport.ts"
      to: "ical-generator"
      via: "import ical from 'ical-generator'"
      pattern: "import.*ical-generator"
    - from: "downloadCampaignICal"
      to: "browser download"
      via: "URL.createObjectURL and Blob"
      pattern: "URL\\.createObjectURL|new Blob"
---

<objective>
Create iCal generation utility that converts campaign schedules to downloadable .ics files

Purpose: Enable users to export campaign schedules to external calendar applications (Google Calendar, Outlook, Apple Calendar)
Output: Working generateCampaignICal() and downloadCampaignICal() functions in src/utils/icalExport.ts
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/11-ical-export-integration/11-CONTEXT.md
@.planning/phases/11-ical-export-integration/11-RESEARCH.md
@.planning/ROADMAP.md

@src/types/campaign.ts
@src/components/campaign/CampaignManager.tsx
</context>

<tasks>

<task type="auto">
  <name>Install ical-generator library</name>
  <files>package.json</files>
  <action>
    Run: npm install ical-generator

    This installs the iCal generation library with built-in TypeScript support.
    Do NOT install @types/ical-generator - types are bundled with the library.
  </action>
  <verify>grep "ical-generator" package.json returns the dependency entry</verify>
  <done>ical-generator is in package.json dependencies and node_modules</done>
</task>

<task type="auto">
  <name>Create iCal export utility module</name>
  <files>src/utils/icalExport.ts</files>
  <action>
    Create src/utils/icalExport.ts with two exported functions:

    1. generateCampaignICal(campaign: Campaign): string
       - Creates ical-generator instance with prodId set to {company: 'Phish Monger', product: 'Phish Monger Campaigns', language: 'EN'}
       - Filters campaign.campaignPhishes for those with scheduledDate
       - For each scheduled phish:
         * Parse scheduledDate (ISO 8601 date string like "2026-03-15")
         * Set start time to 9:00 AM UTC on that date (create Date, set hours to 9 using UTC methods)
         * Set end time to 10:00 AM UTC (start + 1 hour)
         * Create event with:
           - summary: "${campaign.name}: ${phish.title}"
           - description: phish.description or empty string
           - uid: crypto.randomUUID()
           - start/end: Date objects
       - Return calendar.toString()

    2. downloadCampaignICal(campaign: Campaign): void
       - Calls generateCampaignICal(campaign) to get ics content
       - Sanitizes campaign name for filename: replace non-alphanumeric chars with underscore, toLowerCase
       - Creates filename: "${sanitizedName}_calendar.ics"
       - Creates Blob with type 'text/calendar; charset=utf-8'
       - Uses URL.createObjectURL pattern:
         * Create blob, get URL, create hidden link, append to body, click, remove, revokeObjectURL
       - Follow existing pattern from CampaignManager.tsx handleExport function

    IMPORTANT: Use UTC times (new Date(dateString + 'T09:00:00Z')) to avoid timezone complexity.
    Use crypto.randomUUID() for UIDs (not uuid package - use native browser API).
    Import Campaign type from '../types/campaign'.

    Reference RESEARCH.md code examples for exact implementation.
  </action>
  <verify>File exists at src/utils/icalExport.ts with exports: generateCampaignICal, downloadCampaignICal</verify>
  <done>iCal export utility generates valid .ics content with one event per scheduled phish</done>
</task>

</tasks>

<verification>
1. ical-generator is in package.json dependencies
2. src/utils/icalExport.ts exists and exports both functions
3. generateCampaignICal accepts Campaign and returns string
4. downloadCampaignICal accepts Campaign, triggers browser download
5. Events use 9:00 AM UTC time, 1-hour duration
6. Event title format: "Campaign Name: Phish Title"
</verification>

<success_criteria>
1. ical-generator library installed successfully
2. generateCampaignICal function creates RFC 5545 compliant .ics content
3. downloadCampaignICal function triggers file download with correct filename
4. Each scheduled phish becomes a separate VEVENT
5. UIDs are generated using crypto.randomUUID()
6. Time handling uses UTC to avoid timezone complexity
</success_criteria>

<output>
After completion, create `.planning/phases/11-ical-export-integration/11-01-SUMMARY.md`
</output>
