---
phase: 12-detail-carousel
plan: 04
type: execute
wave: 2
depends_on: [12-03]
files_modified:
  - src/App.tsx
  - src/components/campaign/CampaignCard.tsx
autonomous: false

must_haves:
  truths:
    - "User can open carousel from campaign list via 'View Carousel' button"
    - "Keyboard arrow keys navigate carousel (left/right)"
    - "Carousel maintains selected state on keyboard navigation"
  artifacts:
    - path: "src/App.tsx"
      provides: "CampaignCarouselModal integration with state management"
      contains: "showCampaignCarousel|CampaignCarouselModal"
    - path: "src/components/campaign/CampaignCard.tsx"
      provides: "View Carousel button for opening carousel modal"
      contains: "onViewCarousel"
  key_links:
    - from: "App.tsx"
      to: "CampaignCarouselModal.tsx"
      via: "Import and conditional rendering"
      pattern: "CampaignCarouselModal"
    - from: "CampaignCard.tsx"
      to: "CampaignCarouselModal"
      via: "onViewCarousel callback prop"
      pattern: "onViewCarousel"
---

<objective>
Integrate carousel modal into app with keyboard navigation and campaign list access

Purpose: Enable users to access carousel from campaign UI and navigate using keyboard shortcuts
Output: Campaign carousel fully integrated with keyboard support
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-detail-carousel/12-CONTEXT.md

@src/App.tsx
@src/components/campaign/CampaignCard.tsx
@src/components/campaign/CampaignCarouselModal.tsx
@.planning/phases/10-campaign-manager-ui/10-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add keyboard navigation to CampaignCarousel</name>
  <files>src/components/campaign/CampaignCarousel.tsx</files>
  <action>
Add keyboard navigation to CampaignCarousel component:

Add keyboard handler:
- Use useEffect to add keydown event listener when component mounts
- Listen for ArrowLeft and ArrowRight keys
- ArrowLeft: scroll left by card width + gap (216px = 200px + 16px gap)
- ArrowRight: scroll right by same amount
- Clean up event listener on unmount

Scroll implementation:
- Use scrollContainerRef.current.scrollBy()
- behavior: 'smooth'
- left: +/-216 for each keypress

Focus management:
- Add tabIndex={0} to scroll container for keyboard focus
- Add outline style on focus for accessibility
- Prevent default scroll behavior when arrow keys pressed

State updates:
- Arrow key navigation should update selectedPhishId based on visible card
- Use IntersectionObserver or scroll position to determine newly selected card
- Or: Keep simple and don't update selection on arrow key scroll (selection only on click)

Follow existing keyboard shortcut pattern from App.tsx (useHotkeys from react-hotkeys-hook):
- Consider using useHotkeys if available for cleaner implementation
- Or use native addEventListener for simple case

Import useHotkeys from 'react-hotkeys-hook' (already in dependencies from App.tsx):
```tsx
useHotkeys('arrowleft', (e) => {
  e.preventDefault()
  scrollLeft()
}, { enableOnFormTags: true }, [scrollContainerRef])

useHotkeys('arrowright', (e) => {
  e.preventDefault()
  scrollRight()
}, { enableOnFormTags: true }, [scrollContainerRef])
```
</action>
  <verify>
ArrowLeft/ArrowRight keys scroll carousel smoothly, focus visible
</verify>
  <done>
Keyboard navigation works for carousel scrolling
</done>
</task>

<task type="auto">
  <name>Task 2: Add View Carousel button to CampaignCard</name>
  <files>src/components/campaign/CampaignCard.tsx</files>
  <action>
Add "View Carousel" button to CampaignCard:

Add new prop:
- onViewCarousel: () => void callback

Add button to action button row (between Edit and Delete or after Export Calendar):
- Label: "View Carousel"
- Styling: Purple/violet (#8b5cf6) to distinguish from Edit (blue) and other actions
- Same padding and sizing as other action buttons

Button placement (in button group, lines 110-168):
- After "Export Calendar" button
- Before "Delete" button (delete should remain last)
- Or: Place after Edit as secondary action

Only show button when campaign has phishes:
- Condition: campaign.campaignPhishes.length > 0
- If no phishes, either hide button or show disabled state

Follow existing button pattern:
```tsx
<button
  onClick={onViewCarousel}
  style={{
    padding: '6px 12px',
    fontSize: '13px',
    backgroundColor: '#8b5cf6',
    color: 'white',
    border: 'none',
    borderRadius: '4px',
    cursor: 'pointer',
    fontWeight: '500',
  }}
>
  View Carousel
</button>
```
</action>
  <verify>
CampaignCard has onViewCarousel prop, View Carousel button renders with correct styling
</verify>
  <done>
View Carousel button visible on campaign cards
</done>
</task>

<task type="auto">
  <name>Task 3: Integrate CampaignCarouselModal into App.tsx</name>
  <files>src/App.tsx</files>
  <action>
Integrate campaign carousel modal into App.tsx:

Import CampaignCarouselModal:
```tsx
import { CampaignCarouselModal } from './components/campaign/CampaignCarouselModal'
```

Add state (near other campaign state, line 132):
```tsx
const [showCampaignCarousel, setShowCampaignCarousel] = useState(false)
const [carouselCampaign, setCarouselCampaign] = useState<Campaign | undefined>(undefined)
```

Add handler functions (near other campaign handlers, line 352):
```tsx
const handleViewCarousel = (campaign: Campaign) => {
  setCarouselCampaign(campaign)
  setShowCampaignCarousel(true)
  setShowCampaignManager(false) // Close campaign list when opening carousel
}

const handleCloseCarousel = () => {
  setShowCampaignCarousel(false)
  setCarouselCampaign(undefined)
}
```

Update CampaignManager props (line 592-597):
- Pass onCarousel prop: onCarousel={handleViewCarousel}
- Note: CampaignCard needs to receive and pass through this callback

Add modal rendering (near other modals, line 606):
```tsx
{showCampaignCarousel && carouselCampaign && (
  <CampaignCarouselModal
    isOpen={showCampaignCarousel}
    onClose={handleCloseCarousel}
    campaign={carouselCampaign}
  />
)}
```

Update CampaignManager component props:
- The CampaignManager receives CampaignCard components
- CampaignCard needs onViewCarousel callback
- Update CampaignCard usage in CampaignManager.tsx to pass onViewCarousel
- Or: Have CampaignManager accept onCarousel prop and pass to all cards

Since CampaignCard is rendered inside CampaignManager (line 305-313 in CampaignManager.tsx):
- Add onCarousel prop to CampaignManager interface
- Pass onCarousel={onCarousel} to CampaignCard in map
- In App.tsx, pass onCarousel={handleViewCarousel} to CampaignManager
</action>
  <verify>
App.tsx imports CampaignCarouselModal, has carousel state, modal renders, CampaignManager passes onCarousel
</verify>
  <done>
Carousel accessible from campaign list via View Carousel button
</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete carousel integration with keyboard navigation and campaign list access</what-built>
  <how-to-verify>
1. Click "Campaigns" button in app header
2. Find a campaign with phishes (or create one and add phishes)
3. Click "View Carousel" button on campaign card
4. Verify carousel opens with phish cards
5. Use mouse/touch to scroll horizontally
6. Click Prev/Next buttons to navigate
7. Press ArrowLeft/ArrowRight keys to navigate
8. Click a phish card to open read-only editor
9. Verify phish content displays (email + annotations)
10. Click "Back to Carousel" button
11. Verify scroll position is preserved
12. Click X or outside modal to close
13. Repeat with 5+ phishes to verify performance
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>
</tasks>

<verification>
1. CampaignCarousel component handles ArrowLeft/ArrowRight key events
2. CampaignCard has onViewCarousel prop and button
3. CampaignManager accepts and passes onCarousel to CampaignCard
4. App.tsx has showCampaignCarousel and carouselCampaign state
5. CampaignCarouselModal renders conditionally in App.tsx
6. View Carousel button opens modal with correct campaign
7. Keyboard navigation works smoothly
8. Click workflow works end-to-end (list -> carousel -> editor -> carousel -> close)
</verification>

<success_criteria>
1. User can access carousel from campaign list
2. Keyboard navigation (arrow keys) works in carousel
3. Full workflow functions: list -> carousel -> editor -> back -> close
4. No console errors or warnings
5. UI matches existing modal patterns
</success_criteria>

<output>
After completion, create `.planning/phases/12-detail-carousel/12-04-SUMMARY.md`
</output>
