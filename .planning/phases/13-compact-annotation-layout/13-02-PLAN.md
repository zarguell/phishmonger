---
phase: 13-compact-annotation-layout
plan: 02
type: execute
wave: 2
depends_on: [13-01]
files_modified:
  - src/components/preview/SlideWrapper.tsx
  - src/components/campaign/ReadOnlyEditor.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can toggle compact layout via button in ReadOnlyEditor header"
    - "Toggle button shows current state (Compact View vs Expanded View)"
    - "Toggle preference persists across browser sessions via localStorage"
    - "Compact layout applies to annotation display when enabled"
    - "Compact layout does not affect email column, only annotations"
  artifacts:
    - path: "src/components/preview/SlideWrapper.tsx"
      provides: "compactAnnotations prop support for conditional CSS class application"
      exports: ["SlideWrapper"]
      contains: "compactAnnotations prop"
    - path: "src/components/campaign/ReadOnlyEditor.tsx"
      provides: "Compact layout toggle button and state management"
      exports: ["ReadOnlyEditor"]
      contains: "compactLayout state, toggleCompactLayout handler"
  key_links:
    - from: "ReadOnlyEditor component mount"
      to: "loadCompactLayout()"
      via: "useState lazy initialization"
      pattern: "useState\\(\\(\\) => loadCompactLayout\\(\\)\\)"
    - from: "compactLayout state change"
      to: "saveCompactLayout(compactLayout)"
      via: "useEffect with compactLayout dependency"
      pattern: "useEffect.*saveCompactLayout"
    - from: "ReadOnlyEditor compactLayout state"
      to: "SlideWrapper compactAnnotations prop"
      via: "Prop passing in JSX"
      pattern: "compactAnnotations=\\{compactLayout\\}"
    - from: "SlideWrapper compactAnnotations prop"
      to: "compact-annotations CSS class"
      via: "Conditional class concatenation in getSlideWrapperClasses()"
      pattern: "compactAnnotations.*compact-annotations"
---

<objective>
Add compact layout toggle to ReadOnlyEditor with localStorage persistence and conditional CSS application via dedicated compactAnnotations prop on SlideWrapper.

Purpose: Allow users browsing campaign phishes in the carousel to switch to a denser annotation layout for quick scanning of many annotations, while maintaining the ability to expand for detailed reading. Preference persists across sessions.

Output: SlideWrapper extended with compactAnnotations prop, ReadOnlyEditor with compact layout toggle button, state management, and conditional CSS application.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/13-compact-annotation-layout/13-01-SUMMARY.md
@.planning/phases/13-compact-annotation-layout/13-RESEARCH.md
@.planning/phases/12-detail-carousel/12-02-SUMMARY.md
@src/components/preview/SlideWrapper.tsx
@src/components/campaign/ReadOnlyEditor.tsx
@src/components/visualizer/LayoutTemplateSelector.tsx
</context>

<tasks>

<task type="auto">
  <name>Add compactAnnotations prop to SlideWrapper</name>
  <files>src/components/preview/SlideWrapper.tsx</files>
  <action>
    Modify src/components/preview/SlideWrapper.tsx:

    1. Add compactAnnotations prop to SlideWrapperProps interface:
       ```typescript
       interface SlideWrapperProps {
         children: React.ReactNode
         annotations: Record<string, import('../../types/annotations').Annotation>
         scoring?: ScoringData
         showBadge?: boolean
         layoutTemplate?: LayoutTemplate
         compactAnnotations?: boolean
       }
       ```

    2. Add compactAnnotations parameter to component function signature:
       ```typescript
   ({ children, scoring, showBadge = true, layoutTemplate = 'balanced', compactAnnotations = false }, ref)
       ```

    3. Update getSlideWrapperClasses() to conditionally add compact-annotations class:
       ```typescript
       const getSlideWrapperClasses = (): string => {
         const baseClass = styles.slideWrapper
         const templateClass = styles[layoutTemplate]
         const compactClass = compactAnnotations ? styles['compact-annotations'] : ''
         return `${baseClass} ${templateClass} ${compactClass}`.trim()
       }
       ```

    Do NOT modify LayoutTemplate type in LayoutTemplateSelector.tsx - the compact-annotations feature is specific to ReadOnlyEditor and uses a separate prop.
  </action>
  <verify>
    Run `npm run build` - TypeScript compiles without errors. Confirm that compactAnnotations prop is optional (defaults to false) and that SlideWrapper accepts both layoutTemplate and compactAnnotations props simultaneously.
  </verify>
  <done>
    SlideWrapper accepts compactAnnotations boolean prop, applies styles['compact-annotations'] CSS class when true, works alongside existing layoutTemplate prop.
  </done>
</task>

<task type="auto">
  <name>Add compact layout state and toggle button to ReadOnlyEditor</name>
  <files>src/components/campaign/ReadOnlyEditor.tsx</files>
  <action>
    Modify src/components/campaign/ReadOnlyEditor.tsx:

    1. Import loadCompactLayout and saveCompactLayout from storage.ts:
       ```typescript
       import { loadCompactLayout, saveCompactLayout } from '../../utils/storage'
       ```

    2. Add compactLayout state with lazy initialization from localStorage:
       ```typescript
       const [compactLayout, setCompactLayout] = useState(() => loadCompactLayout())
       ```

    3. Add useEffect to persist state changes:
       ```typescript
       useEffect(() => {
         saveCompactLayout(compactLayout)
       }, [compactLayout])
       ```

    4. Add toggle button to header (between "Show/Hide Annotations" and "Copy HTML" buttons):
       - Button text: "Compact View" when expanded, "Expanded View" when compact
       - Background color: #6c757d (gray) when compact, #8b5cf6 (purple) when expanded
       - Padding: 8px 16px
       - Border radius: 4px
       - Font size: 13px
       - Title attribute for tooltip
       - onClick: () => setCompactLayout(!compactLayout)

    5. Pass compactAnnotations prop to SlideWrapper:
       ```typescript
       <SlideWrapper compactAnnotations={compactLayout}>
       ```

    The compactAnnotations prop was added to SlideWrapper in the previous task - this task completes the wiring by passing the state through.
  </action>
  <verify>
    Run `npm run build` - TypeScript compiles without errors. Open ReadOnlyEditor, click toggle button, verify:
    - Button text changes between "Compact View" and "Expanded View"
    - Button color changes
    - Refresh page - preference persists
    - Annotation fonts and spacing change when toggled
  </verify>
  <done>
    Toggle button visible in ReadOnlyEditor header, clicking toggles state, preference persists across page reloads, compact layout CSS applies when enabled via compactAnnotations prop on SlideWrapper.
  </done>
</task>

</tasks>

<verification>
1. SlideWrapper accepts compactAnnotations prop (optional, defaults to false)
2. Toggle button appears in ReadOnlyEditor header
3. Clicking toggle changes button text and color
4. After refresh, toggle state is preserved
5. Compact layout reduces annotation font sizes when enabled
6. Email column is unaffected by compact layout
</verification>

<success_criteria>
1. User can click toggle button to switch between Compact View and Expanded View
2. Compact View shows smaller fonts (12px) and tighter spacing
3. Expanded View shows standard fonts and spacing
4. Preference persists after browser refresh
5. No visual artifacts or layout breaks when toggling
6. LayoutTemplate type is NOT modified (uses separate prop approach)
</success_criteria>

<output>
After completion, create `.planning/phases/13-compact-annotation-layout/13-02-SUMMARY.md`
</output>
