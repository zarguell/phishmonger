---
phase: 19-editor-column-flexibility
plan: 03
type: execute
wave: 3
depends_on: [19-02]
files_modified:
  - src/App.tsx
  - src/utils/storage.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Column focus state persists across page refresh (localStorage saves focusedColumn)"
    - "Reloading page restores previous column focus state"
    - "User can exit focus mode by clicking expand button on focused column again"
    - "Column states (expanded/minimized) persist across sessions"
  artifacts:
    - path: "src/utils/storage.ts"
      provides: "loadFocusedColumn(), saveFocusedColumn() utilities"
      exports: ["loadFocusedColumn", "saveFocusedColumn"]
    - path: "src/App.tsx"
      provides: "focusedColumn state initialized from localStorage"
      contains: "useState(() => loadFocusedColumn())"
  key_links:
    - from: "src/App.tsx"
      to: "localStorage"
      via: "saveFocusedColumn in useEffect"
      pattern: "useEffect.*saveFocusedColumn"
    - from: "src/App.tsx"
      to: "src/utils/storage.ts"
      via: "import loadFocusedColumn"
      pattern: "import.*loadFocusedColumn"
---

<objective>
Implement localStorage persistence for column focus state so column expansion survives page refresh.

Purpose: Users expect their column layout preference to persist between sessions.
Output: Focused column state saves to localStorage and restores on page load.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-editor-column-flexibility/19-RESEARCH.md
@src/App.tsx
@src/utils/storage.ts
@.planning/phases/19-editor-column-flexibility/19-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Add focused column storage utilities</name>
  <files>src/utils/storage.ts</files>
  <action>
    Add to src/utils/storage.ts (after saveColumnStates, before campaign storage):

    1. FOCUSED_COLUMN_KEY = 'phishmonger-focused-column'

    2. loadFocusedColumn() function:
       - Reads from localStorage using FOCUSED_COLUMN_KEY
       - Returns null if not found or if value is not a valid ColumnID
       - Type: () => ColumnID | null
       - Handle parse errors with try-catch, return null on error

    3. saveFocusedColumn(columnId: ColumnID | null) function:
       - Saves to localStorage using FOCUSED_COLUMN_KEY
       - If columnId is null, removes the item (localStorage.removeItem)
       - Handle QuotaExceededError gracefully

    Follow existing storage pattern (similar to loadCompactLayout/saveCompactLayout).
    Import ColumnID type from '../types/columns'.
  </action>
  <verify>grep -q "FOCUSED_COLUMN_KEY" src/utils/storage.ts && grep -q "loadFocusedColumn" src/utils/storage.ts && grep -q "saveFocusedColumn" src/utils/storage.ts</verify>
  <done>Storage utilities exist for focused column state</done>
</task>

<task type="auto">
  <name>Integrate focused column persistence in App.tsx</name>
  <files>src/App.tsx</files>
  <action>
    Modify src/App.tsx:

    1. Add import at top (with other storage imports):
       - import { loadFocusedColumn, saveFocusedColumn } from './utils/storage'

    2. Change focusedColumn state initialization (around line 163):
       - FROM: const [focusedColumn, setFocusedColumn] = useState<ColumnID | null>(null)
       - TO: const [focusedColumn, setFocusedColumn] = useState<ColumnID | null>(() => loadFocusedColumn())

    3. Add useEffect after columnStates useEffect (after line 200):
       ```typescript
       useEffect(() => {
         saveFocusedColumn(focusedColumn)
       }, [focusedColumn])
       ```

    This ensures:
    - Focus state loads from localStorage on app mount
    - Focus state saves to localStorage whenever it changes
    - User sees their previous layout after refresh

    Do NOT modify toggleColumnFocus function logic - it already toggles correctly.
  </action>
  <verify>grep -q "loadFocusedColumn" src/App.tsx && grep -q "saveFocusedColumn" src/App.tsx</verify>
  <done>Column focus state persists across page refreshes</done>
</task>

</tasks>

<verification>
1. Storage utilities exist in storage.ts
2. App.tsx imports and uses loadFocusedColumn/saveFocusedColumn
3. Manual test: Expand input column -> refresh page -> input column still expanded
4. Manual test: Click expand again (reset) -> refresh page -> all columns visible
</verification>

<success_criteria>
1. Focused column state loads from localStorage on app initialization
2. State persists to localStorage whenever focusedColumn changes
3. Page refresh restores previous column focus state
4. Resetting focus (clicking expand on already-focused column) clears localStorage
</success_criteria>

<output>
After completion, create `.planning/phases/19-editor-column-flexibility/19-03-SUMMARY.md`
</output>
