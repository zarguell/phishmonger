---
phase: 18-clean-html-export
plan: 03
type: execute
wave: 3
depends_on:
  - 18-02
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Downloaded HTML file contains no lure mark elements ([data-lure-id])"
    - "Downloaded HTML file contains no annotation badge elements ([data-annotation-number])"
    - "Downloaded HTML renders correctly in browser (email structure preserved)"
    - "Clipboard copy contains clean HTML without annotations"
    - "Original phish.htmlSource remains unchanged in LocalStorage"
  artifacts: []
  key_links:
    - from: "Downloaded HTML file"
      to: "Email client or browser"
      via: "File open or paste"
      pattern: "N/A - manual verification"
---

<objective>
Validate clean HTML export functionality with human testing.

Purpose: Verify that exported HTML works correctly in real-world scenarios (email clients, browsers) and that source data is not modified.
Output: Verified working clean HTML export feature.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/18-clean-html-export/18-RESEARCH.md

# Implementation to verify
@.planning/phases/18-clean-html-export/18-01-SUMMARY.md
@.planning/phases/18-clean-html-export/18-02-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete clean HTML export feature:
    - Utility module (cleanHtmlExport.ts) with DOMParser-based sanitization
    - ReadOnlyEditor UI with "Download Clean HTML" and "Copy Clean HTML" buttons
  </what-built>
  <how-to-verify>
1. Start the application: `npm run dev`
2. Open a campaign with sample phishes or create a new phish with annotations
3. Click "View Carousel" to open the campaign carousel
4. Click on a phish to open ReadOnlyEditor
5. Click "Download Clean HTML" button
   - Verify browser downloads an HTML file
   - Open the downloaded file in a text editor
   - Confirm NO `<span data-lure-id="...">` elements exist
   - Confirm NO `<span class="lure-badge" data-annotation-number="...">` elements exist
   - Confirm email structure (tables, links, styles) is preserved
6. Open the downloaded HTML file in a browser
   - Verify email renders correctly without broken layout
7. Return to ReadOnlyEditor, click "Copy Clean HTML"
   - Verify "Clean HTML copied to clipboard!" alert appears
   - Paste into a text editor
   - Confirm clean HTML (no lure marks or badges)
8. Refresh the page and reopen the same phish
   - Verify annotations still display (source data unchanged)
9. Check browser DevTools Console
   - Confirm NO errors related to export functionality
  </how-to-verify>
  <resume-signal>
Type "approved" if all verification steps pass. Describe any issues found.
  </resume-signal>
</task>

</tasks>

<verification>
After human approval:
- [ ] Downloaded HTML file contains no lure mark elements
- [ ] Downloaded HTML file contains no annotation badge elements
- [ ] Downloaded HTML renders correctly in browser
- [ ] Clipboard copy contains clean HTML
- [ ] Original phish data unchanged (annotations still show after refresh)
- [ ] No console errors
</verification>

<success_criteria>
1. Clean HTML export works correctly (file download and clipboard copy)
2. Exported HTML is free of annotation UI artifacts
3. Exported HTML renders correctly in browsers
4. Source data is not modified by export operations
</success_criteria>

<output>
After completion, create `.planning/phases/18-clean-html-export/18-03-SUMMARY.md`
</output>
