---
phase: 01-editor-foundation
plan: 07
type: execute
wave: 6
depends_on: ["01-05", "01-06"]
files_modified: []
autonomous: false
user_setup: []
gap_closure: true

must_haves:
  truths:
    - "User can type and format text in Rich Text mode"
    - "User can paste HTML email content in HTML mode"
    - "User can switch between HTML and Rich Text modes"
    - "Preview pane renders HTML correctly"
    - "User can select text in Preview pane"
    - "Mark Lure button creates yellow highlight with UUID"
    - "Lure marks appear in LureList sidebar"
    - "Multiple lures can be marked"
    - "LocalStorage saves all content and mode preference"
    - "Content restores correctly on page reload"

  artifacts: []

  key_links: []
---

<objective>
Verify the complete Phase 1 editor workflow works correctly: mode switching, HTML paste, rich text editing, Lure marking, Preview rendering, and LocalStorage persistence.

Purpose: This is the final verification that Phase 1 requirements are met after the architectural pivot to split Editor/Viewer architecture.
Output: User confirms all features work as expected through manual testing
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/01-editor-foundation/01-04-ARCHITECTURAL-DECISION.md
@.planning/phases/01-editor-foundation/01-05-SUMMARY.md
@.planning/phases/01-editor-foundation/01-06-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 1 editor workflow with split Editor/Viewer architecture:
    - Rich Text mode with formatting toolbar
    - HTML Input mode with direct HTML editing
    - Mode toggle with content preservation
    - Preview pane rendering sanitized HTML
    - Lure marking with UUID generation and yellow highlighting
    - LureList sidebar showing all marked lures
    - LocalStorage persistence for content and mode preference
    - Security: script stripping and dangerous attribute removal
  </what-built>

  <how-to-verify>
    **1. Start dev server:**
    ```bash
    npm run dev
    ```

    **2. Visit:** http://localhost:5173

    **3. Test Rich Text mode (default):**
    - Type text in the right panel (Rich Text editor)
    - Click Bold button, select text → verify bold formatting
    - Click Italic button, select text → verify italic formatting
    - Click Link button, select text, enter URL → verify link creation

    **4. Test mode toggle:**
    - Click "HTML Input" radio button
    - Verify Rich Text editor disappears, HTML textarea appears
    - Click "Rich Text" radio button
    - Verify HTML textarea disappears, Rich Text editor reappears
    - Verify content is preserved between modes (not lost)

    **5. Test HTML paste and sanitization:**
    - Switch to HTML Input mode
    - Paste this test HTML:
      ```html
      <table style="border: 1px solid black; width: 100%;">
        <tr><td style="background: yellow; padding: 10px;">
          <strong>URGENT:</strong> Click here now!
        </td></tr>
      </table>
      <script>alert('XSS')</script>
      <p onclick="alert('click')">Click me</p>
      ```
    - Look at Preview pane (middle column)
    - Verify: Table is rendered with yellow background and bold text
    - Verify: No alert popup (scripts stripped)
    - Verify: Clicking text does nothing (onclick stripped)

    **6. Test Lure marking:**
    - In Preview pane, select "URGENT: Click here now!"
    - Click "Mark Lure" button in Preview header
    - Verify: Yellow highlight appears around selected text
    - Verify: Lure appears in LureList sidebar (right column)
    - Verify: LureList shows UUID and text preview

    **7. Test multiple lures:**
    - Select another text segment in Preview pane
    - Click "Mark Lure" again
    - Verify: Second lure appears with different UUID
    - Verify: LureList shows both lures

    **8. Test LocalStorage persistence:**
    - Open browser DevTools → Application → Local Storage
    - Verify keys exist: `phishmonger-content`, `phishmonger-mode`
    - Refresh page (Cmd+R or F5)
    - Verify: All content restored (HTML source, lures, mode preference)
    - Verify: All highlights reappear in Preview pane

    **9. Test lure list interaction:**
    - Click a lure in LureList sidebar
    - Verify: Preview pane scrolls to that lure
    - Verify: Lure highlights briefly
  </how-to-verify>

  <resume-signal>Type "approved" if all features work correctly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
This is a human verification checkpoint. No automated verification needed.
</verification>

<success_criteria>
1. **Rich Text mode:** Typing, bold, italic, and link formatting work correctly
2. **HTML mode:** Can paste and edit HTML email content
3. **Mode toggle:** Switches between Rich Text and HTML modes without losing content
4. **Preview pane:** Renders HTML as the victim would see it
5. **Lure marking:** Select text in Preview, click "Mark Lure", yellow highlight appears with UUID
6. **LureList sidebar:** Shows all marked lures with UUIDs and text previews
7. **LocalStorage persistence:** Saves and restores all content, lures, and mode preference on reload
8. **Security:** Scripts and dangerous attributes (onclick, onerror, etc.) are stripped from pasted HTML
</success_criteria>

<output>
After completion, create `.planning/phases/01-editor-foundation/01-07-SUMMARY.md` with verification results
</output>
