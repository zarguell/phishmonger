---
phase: 10-campaign-manager-ui
plan: 03
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - src/components/campaign/CampaignEditor.tsx
autonomous: true

must_haves:
  truths:
    - "User can edit campaign name and description"
    - "User can see list of phishes in campaign"
    - "User can add current project to campaign"
    - "User can set scheduled date for each phish"
    - "User can remove phish from campaign"
    - "User can save changes to campaign"
    - "User can cancel editing without saving"
  artifacts:
    - path: "src/components/campaign/CampaignEditor.tsx"
      provides: "Campaign editing modal with phish management"
      exports: ["CampaignEditor"]
      min_lines: 140
  key_links:
    - from: "CampaignEditor.tsx"
      to: "src/components/campaign/CampaignPhishItem.tsx"
      via: "import CampaignPhishItem"
      pattern: "import.*CampaignPhishItem.*from"
    - from: "CampaignEditor.tsx"
      to: "src/hooks/useCampaigns.ts"
      via: "useCampaigns for updateCampaign, addPhishToCampaign, removePhishFromCampaign"
      pattern: "useCampaigns.*updateCampaign|addPhishToCampaign"
    - from: "CampaignEditor.tsx"
      to: "src/utils/campaignCopy.ts"
      via: "copyPhishForCampaign utility"
      pattern: "copyPhishForCampaign"
    - from: "CampaignEditor.tsx"
      to: "src/types/campaign.ts"
      via: "Campaign, CampaignPhish types"
      pattern: "import.*Campaign.*from.*campaign"
---

<objective>
Build the CampaignEditor modal - the interface for editing campaign details and managing phishes within a campaign, including adding the current project, scheduling dates, and removing phishes.

Purpose: Provides full campaign editing capabilities where users can modify campaign metadata, manage the list of phishes, assign scheduled dates, and save changes. This is where users organize their phishing exercises into campaigns.

Output: CampaignEditor modal component with form fields for campaign metadata, phish list with date pickers, "add current project" button, and save/cancel actions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-campaign-manager-ui/10-RESEARCH.md
@.planning/phases/10-campaign-manager-ui/10-CONTEXT.md
@.planning/phases/10-campaign-manager-ui/10-01-SUMMARY.md

@src/types/campaign.ts
@src/types/phish.ts
@src/hooks/useCampaigns.ts
@src/utils/campaignCopy.ts
@src/components/campaign/CampaignPhishItem.tsx
@src/components/library/CustomTechniqueEditor.tsx
</context>

<tasks>

<task type="auto">
  <name>Create CampaignEditor modal with campaign metadata form</name>
  <files>src/components/campaign/CampaignEditor.tsx</files>
  <action>
    Create CampaignEditor component following CustomTechniqueEditor form pattern:

    Props interface:
    - campaign: Campaign (the campaign being edited)
    - onClose: () => void
    - onSave: (campaignId: string, updates: Partial<Omit<Campaign, 'id' | 'createdAt'>>) => void
    - currentProject: Phish (the current working project to copy into campaign)

    Modal structure (following TechniqueLibrary pattern):
    - Fixed overlay: position fixed, inset 0, bg-black/50, z-50
    - Container: centered, max-w-2xl, max-h-[90vh], overflow-y-auto
    - Header: "Edit Campaign" title + close button (Ã—)
    - Content: Scrollable form area
    - Footer: Save and Cancel buttons

    Form fields (controlled inputs):
    - Name input (required):
      * value: local state name (initialized from campaign.name)
      * onChange: updates local state
      * Error state shown below if empty
      * Border: red if error, gray if valid

    - Description textarea (optional):
      * value: local state description
      * onChange: updates local state
      * rows: 3
      * Placeholder: "Describe this campaign..."

    Follow CustomTechniqueEditor.tsx validation pattern:
    - errors object with name field
    - validateForm() function called on submit
    - Save button disabled while form invalid

    Local state:
    - formData: { name: string, description: string }
    - errors: { name?: string }
    - campaignPhishes: CampaignPhish[] (initialized from campaign.campaignPhishes)

    DO NOT use external form libraries - controlled components with useState.
  </action>
  <verify>
    File exists at src/components/campaign/CampaignEditor.tsx with:
    - CampaignEditor component exported
    - Props interface with campaign, onClose, onSave, currentProject
    - Modal overlay following existing pattern
    - Controlled form inputs for name and description
    - Form validation (name required)
  </verify>
  <done>
    CampaignEditor modal displays with campaign name and description form fields. Form validation ensures name is required.
  </done>
</task>

<task type="auto">
  <name>Add phish list with date editing and remove functionality</name>
  <files>src/components/campaign/CampaignEditor.tsx</files>
  <action>
    Add phish list section to CampaignEditor:

    Section structure:
    - Heading: "Phishes in this campaign (X)"
    - List container: max-height with overflow for scrolling
    - Map through campaignPhishes state
    - Render CampaignPhishItem for each phish

    CampaignPhishItem props:
    - phish: individual CampaignPhish from array
    - onDateChange: (phishId, date) => update local campaignPhishes state
    - onRemove: (phishId) => remove from local campaignPhishes state

    Date change handling:
    - Find phish by id in campaignPhishes array
    - Update scheduledDate field (can be empty string to clear)
    - Use map to create new array (immutable update)

    Remove handling:
    - Filter campaignPhishes to exclude phish with matching id
    - Confirm before removing: window.confirm("Remove '{phish.metadata.title}' from campaign?")

    Empty state (when campaignPhishes.length === 0):
    - "No phishes in this campaign"
    - "Add your current project to get started"

    Section styling:
    - Border top above section
    - Padding: 16px
    - Background: light gray for section contrast

    Each CampaignPhishItem row is updated independently via the callbacks.
  </action>
  <verify>
    CampaignEditor has:
    - Phish list section with heading
    - CampaignPhishItem rendered for each phish
    - onDateChange callback updating local state
    - onRemove callback with confirm dialog
    - Empty state message when no phishes
  </verify>
  <done>
    Phish list displays all campaign phishes with date pickers and remove buttons. Date changes and removes update local state immediately.
  </done>
</task>

<task type="auto">
  <name>Add "Add Current Project" button with copyPhishForCampaign integration</name>
  <files>src/components/campaign/CampaignEditor.tsx</files>
  <action>
    Add "Add Current Project" button and integration:

    Button placement:
    - Below phish list heading (or above empty state)
    - Primary styling: blue background, white text
    - Icon: + or "Add" prefix
    - Text: "Add Current Project" or "+ Add Current Project"

    Current project display:
    - Show currentProject.metadata.title above button
    - Subtitle: "Current project will be copied into this campaign"
    - Small text, gray color

    On click handler:
    - Import copyPhishForCampaign from src/utils/campaignCopy.ts
    - Call copyPhishForCampaign(currentProject)
    - Result is CampaignPhish (copies all project data)
    - Append to local campaignPhishes state
    - No scheduledDate initially (user can add via picker)

    Duplicate handling:
    - Check if currentProject.id already exists in campaignPhishes
    - If duplicate: alert("This project is already in the campaign")
    - Do NOT add duplicate (per CONTEXT.md decision)

    Visual feedback:
    - Brief success message or button state change after adding
    - Could use inline text: "Project added!" that fades out

    Button disabled state:
    - Disable if currentProject.id is already in campaign
    - Show "(already added)" text or similar

    Integration with save:
    - Modified campaignPhishes are passed to onSave callback
    - Parent calls updateCampaign with full campaign data
  </action>
  <verify>
    CampaignEditor has:
    - "Add Current Project" button
    - Current project title display
    - copyPhishForCampaign imported and used
    - Duplicate check before adding
    - Added phish appears in list immediately
    - Save callback includes updated campaignPhishes
  </verify>
  <done>
    "Add Current Project" button copies current working project into campaign. Duplicate detection prevents adding same project twice. Added phishes appear in list with date picker.
  </done>
</task>

</tasks>

<verification>
1. CampaignEditor modal opens with campaign data pre-filled
2. Name and description fields are editable with validation
3. Phish list shows all campaign phishes
4. Date picker updates scheduledDate in local state
5. Remove button confirms before removing phish
6. "Add Current Project" copies project into campaign
7. Duplicate project detection works
8. Save button updates campaign via onSave callback
9. Cancel button closes modal without saving
10. All CRUD operations use proper immutable state updates
</verification>

<success_criteria>
1. User can edit campaign name and description
2. User can see all phishes in campaign with scheduled dates
3. User can change scheduled dates via date picker
4. User can remove phishes from campaign
5. User can add current project to campaign (with duplicate check)
6. Save persists all changes to campaign
7. Cancel discards unsaved changes
8. Modal follows existing form patterns
</success_criteria>

<output>
After completion, create `.planning/phases/10-campaign-manager-ui/10-03-SUMMARY.md`
</output>
