---
phase: 13-compact-annotation-layout
plan: 02
type: execute
wave: 2
depends_on: [13-01]
files_modified:
  - src/components/campaign/ReadOnlyEditor.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can toggle compact layout via button in ReadOnlyEditor header"
    - "Toggle button shows current state (Compact View vs Expanded View)"
    - "Toggle preference persists across browser sessions via localStorage"
    - "Compact layout applies to annotation display when enabled"
    - "Compact layout does not affect email column, only annotations"
  artifacts:
    - path: "src/components/campaign/ReadOnlyEditor.tsx"
      provides: "Compact layout toggle button and state management"
      exports: ["ReadOnlyEditor"]
      contains: "compactLayout state, toggleCompactLayout handler"
  key_links:
    - from: "ReadOnlyEditor component mount"
      to: "loadCompactLayout()"
      via: "useState lazy initialization"
      pattern: "useState\\(\\(\\) => loadCompactLayout\\(\\)\\)"
    - from: "compactLayout state change"
      to: "saveCompactLayout(compactLayout)"
      via: "useEffect with compactLayout dependency"
      pattern: "useEffect.*saveCompactLayout"
    - from: "SlideWrapper layoutTemplate prop"
      to: "compact-annotations CSS class"
      via: "Conditional ternary for layout class selection"
      pattern: "layoutTemplate.*compact.*annotations"
---

<objective>
Add compact layout toggle to ReadOnlyEditor with localStorage persistence and conditional CSS application.

Purpose: Allow users browsing campaign phishes in the carousel to switch to a denser annotation layout for quick scanning of many annotations, while maintaining the ability to expand for detailed reading. Preference persists across sessions.

Output: ReadOnlyEditor with compact layout toggle button, state management, and conditional CSS application.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/13-compact-annotation-layout/13-01-SUMMARY.md
@.planning/phases/13-compact-annotation-layout/13-RESEARCH.md
@.planning/phases/12-detail-carousel/12-02-SUMMARY.md
@src/components/campaign/ReadOnlyEditor.tsx
@src/components/preview/SlideWrapper.tsx
</context>

<tasks>

<task type="auto">
  <name>Add compact layout state and toggle button to ReadOnlyEditor</name>
  <files>src/components/campaign/ReadOnlyEditor.tsx</files>
  <action>
    Modify src/components/campaign/ReadOnlyEditor.tsx:

    1. Import loadCompactLayout and saveCompactLayout from storage.ts:
       ```typescript
       import { loadCompactLayout, saveCompactLayout } from '../../utils/storage'
       ```

    2. Add compactLayout state with lazy initialization from localStorage:
       ```typescript
       const [compactLayout, setCompactLayout] = useState(() => loadCompactLayout())
       ```

    3. Add useEffect to persist state changes:
       ```typescript
       useEffect(() => {
         saveCompactLayout(compactLayout)
       }, [compactLayout])
       ```

    4. Add toggle button to header (between "Show/Hide Annotations" and "Copy HTML" buttons):
       - Button text: "Compact View" when expanded, "Expanded View" when compact
       - Background color: #6c757d (gray) when compact, #8b5cf6 (purple) when expanded
       - Padding: 8px 16px
       - Border radius: 4px
       - Font size: 13px
       - Title attribute for tooltip
       - onClick: () => setCompactLayout(!compactLayout)

    5. Pass layoutTemplate prop to SlideWrapper:
       - When compactLayout is true: layoutTemplate="compact-annotations"
       - When compactLayout is false: layoutTemplate="balanced" (default)

    NOTE: SlideWrapper currently expects LayoutTemplate type ('balanced' | 'compact' | 'wideEmail' | 'wideAnnotations'). You need to:
    - Either extend the LayoutTemplate type to include 'compact-annotations'
    - Or use the existing 'compact' template and add additional CSS class
    - RECOMMENDED: Extend LayoutTemplate type union and update SlideWrapper to handle 'compact-annotations'

    For the type extension, check src/components/visualizer/LayoutTemplateSelector.tsx for the LayoutTemplate type definition, or define locally if needed.
  </action>
  <verify>
    Run `npm run build` - TypeScript compiles without errors. Open ReadOnlyEditor, click toggle button, verify:
    - Button text changes between "Compact View" and "Expanded View"
    - Button color changes
    - Refresh page - preference persists
  </verify>
  <done>
    Toggle button visible in ReadOnlyEditor header, clicking toggles state, preference persists across page reloads, compact layout CSS applies when enabled.
  </done>
</task>

</tasks>

<verification>
1. Toggle button appears in ReadOnlyEditor header
2. Clicking toggle changes button text and color
3. After refresh, toggle state is preserved
4. Compact layout reduces annotation font sizes when enabled
5. Email column is unaffected by compact layout
</verification>

<success_criteria>
1. User can click toggle button to switch between Compact View and Expanded View
2. Compact View shows smaller fonts (12px) and tighter spacing
3. Expanded View shows standard fonts and spacing
4. Preference persists after browser refresh
5. No visual artifacts or layout breaks when toggling
</success_criteria>

<output>
After completion, create `.planning/phases/13-compact-annotation-layout/13-02-SUMMARY.md`
</output>
