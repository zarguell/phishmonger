---
phase: 18-clean-html-export
plan: 02
type: execute
wave: 2
depends_on:
  - 18-01
files_modified:
  - src/components/campaign/ReadOnlyEditor.tsx
autonomous: true

must_haves:
  truths:
    - "ReadOnlyEditor has two new export buttons in header"
    - "Download button triggers clean HTML file download"
    - "Copy button copies clean HTML to clipboard"
    - "Original 'Copy HTML' button remains (copies raw htmlSource)"
  artifacts:
    - path: "src/components/campaign/ReadOnlyEditor.tsx"
      provides: "Export UI for clean HTML"
      imports_from: "src/utils/cleanHtmlExport"
      imports:
        - "downloadCleanHtml"
        - "copyCleanHtmlToClipboard"
        - "generateCleanHtmlFilename"
  key_links:
    - from: "ReadOnlyEditor.tsx"
      to: "cleanHtmlExport.ts"
      via: "import statement"
      pattern: "from.*cleanHtmlExport"
    - from: "ReadOnlyEditor export buttons"
      to: "cleanHtmlExport functions"
      via: "onClick handlers"
      pattern: "(downloadCleanHtml|copyCleanHtmlToClipboard)\\("
---

<objective>
Add clean HTML export buttons to ReadOnlyEditor component.

Purpose: Provide users with UI to download and copy clean HTML (without lure marks or badges) from the carousel view.
Output: Updated ReadOnlyEditor.tsx with "Download Clean HTML" and "Copy Clean HTML" buttons.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/18-clean-html-export/18-RESEARCH.md

# Reference existing implementation
@src/components/campaign/ReadOnlyEditor.tsx
@src/utils/cleanHtmlExport.ts
@.planning/phases/18-clean-html-export/18-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Add clean HTML export UI to ReadOnlyEditor</name>
  <files>src/components/campaign/ReadOnlyEditor.tsx</files>
  <action>
Modify `src/components/campaign/ReadOnlyEditor.tsx`:

1. **Add import** at top of file:
   ```typescript
   import { downloadCleanHtml, copyCleanHtmlToClipboard, generateCleanHtmlFilename } from '../../utils/cleanHtmlExport'
   ```

2. **Add handler functions** after existing `handleCopyHTML` function (after line 37):
   ```typescript
   const handleDownloadCleanHTML = () => {
     const filename = generateCleanHtmlFilename(phish.metadata.title)
     downloadCleanHtml(phish.htmlSource, filename)
   }

   const handleCopyCleanHTML = async () => {
     try {
       await copyCleanHtmlToClipboard(phish.htmlSource)
       alert('Clean HTML copied to clipboard!')
     } catch (error) {
       console.error('Failed to copy clean HTML:', error)
       alert('Failed to copy clean HTML')
     }
   }
   ```

3. **Add two new buttons** in the header button group (after existing "Copy HTML" button, before closing div tag around line 159):
   - Button 1: "Download Clean HTML"
     - onClick: `handleDownloadCleanHTML`
     - backgroundColor: `#28a745` (green)
     - title: "Download clean HTML file without annotations"
   - Button 2: "Copy Clean HTML"
     - onClick: `handleCopyCleanHTML`
     - backgroundColor: `#fd7e14` (orange)
     - title: "Copy clean HTML to clipboard without annotations"

4. **Style consistently** with existing buttons (use same padding, borderRadius, fontSize, fontWeight, cursor, transition, hover handlers)

5. **DO NOT remove** the existing "Copy HTML" button - it copies raw htmlSource and is still useful

6. **DO NOT modify** the existing `handleCopyHTML` function
  </action>
  <verify>
1. TypeScript compiles without errors: `npm run type-check`
2. Import statement includes all three functions from cleanHtmlExport
3. Two new handler functions defined
4. Two new buttons added to header JSX
5. Original "Copy HTML" button still present
  </verify>
  <done>
ReadOnlyEditor now has four HTML-related buttons: "Copy HTML" (raw), "Copy Clean HTML", "Download Clean HTML", plus the existing Hide Annotations and View Toggle buttons.
</done>
</task>

</tasks>

<verification>
After task completion:
- [ ] Import statement added for cleanHtmlExport functions
- [ ] handleDownloadCleanHTML function generates filename and calls downloadCleanHtml
- [ ] handleCopyCleanHTML function copies to clipboard with user feedback
- [ ] Two new buttons rendered in header with consistent styling
- [ ] Original "Copy HTML" button preserved
- [ ] TypeScript compiles without errors
</verification>

<success_criteria>
1. Users see "Download Clean HTML" and "Copy Clean HTML" buttons in ReadOnlyEditor header
2. Buttons are styled consistently with existing buttons
3. Clicking buttons triggers the appropriate export functions
4. Original functionality (Copy HTML, Hide Annotations, View Toggle) remains intact
</success_criteria>

<output>
After completion, create `.planning/phases/18-clean-html-export/18-02-SUMMARY.md`
</output>
