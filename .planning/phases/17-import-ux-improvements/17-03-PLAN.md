---
phase: 17-import-ux-improvements
plan: 03
type: execute
wave: 2
depends_on: [17-01, 17-02]
files_modified:
  - src/App.tsx
  - src/components/ProjectSettings.tsx
  - src/components/campaign/CampaignManager.tsx
autonomous: false
user_setup: []

must_haves:
  truths:
    - User clicks "Import" button in ProjectSettings, modal opens (no layout shift)
    - User clicks "Import" button in CampaignManager, modal opens (no layout shift)
    - User imports phish via modal, data loads correctly
    - User imports campaign via modal, campaign appears in list
    - Escape key closes both import modals
    - Clicking backdrop closes both import modals
  artifacts:
    - path: "src/App.tsx"
      provides: "Modal state management and import handlers"
      contains: "showPhishImportModal"
    - path: "src/components/ProjectSettings.tsx"
      provides: "Import modal trigger button (replaces expanding menu)"
      contains: "onImportClick"
    - path: "src/components/campaign/CampaignManager.tsx"
      provides: "Import modal trigger button (replaces hidden file input)"
      contains: "onImportClick"
  key_links:
    - from: "src/components/ProjectSettings.tsx"
      to: "src/App.tsx"
      via: "onImportClick prop callback"
      pattern: "onImportClick.*=.*setShowPhishImportModal"
    - from: "src/components/campaign/CampaignManager.tsx"
      to: "src/App.tsx"
      via: "onImportClick prop callback"
      pattern: "onImportClick.*=.*setShowCampaignImportModal"
    - from: "src/App.tsx"
      to: "src/components/import/PhishImportModal.tsx"
      via: "showPhishImportModal state"
      pattern: "PhishImportModal.*isOpen.*showPhishImportModal"
    - from: "src/App.tsx"
      to: "src/components/import/CampaignImportModal.tsx"
      via: "showCampaignImportModal state"
      pattern: "CampaignImportModal.*isOpen.*showCampaignImportModal"
---

<objective>
Integrate import modals into App, ProjectSettings, and CampaignManager

Purpose: Replace expanding menu and hidden file input patterns with modal dialogs, eliminating layout shift and providing consistent UX for both phish and campaign imports
Output: Working modals integrated into existing components with proper state management
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/App.tsx
@src/components/ProjectSettings.tsx
@src/components/campaign/CampaignManager.tsx
@src/components/import/PhishImportModal.tsx
@src/components/import/CampaignImportModal.tsx
@src/utils/storage.ts
@src/hooks/useCampaigns.ts
</context>

<tasks>

<task type="auto">
  <name>Update App.tsx with modal states and handlers</name>
  <files>src/App.tsx</files>
  <action>
Modify src/App.tsx to add import modal support:

**1. Add imports (after line 24):**
```typescript
import { PhishImportModal } from './components/import/PhishImportModal'
import { CampaignImportModal } from './components/import/CampaignImportModal'
```

**2. Add modal state (after showShortcutHelp state around line 161):**
```typescript
const [showPhishImportModal, setShowPhishImportModal] = useState(false)
const [showCampaignImportModal, setShowCampaignImportModal] = useState(false)
```

**3. Add import handlers (reuse existing handleImportJSON from lines 336-359):**
Create handler for phish import modal:
```typescript
const handlePhishImport = (project: ProjectJSON) => {
  handleImportJSON(project)
  setShowPhishImportModal(false)
}
```

Create handler for campaign import modal (add after handlePhishImport):
```typescript
const handleCampaignImport = (campaignData: CampaignInput) => {
  addCampaign(campaignData)
  setShowCampaignImportModal(false)
}
```

**4. Update ProjectSettings props (lines 546-569):**
Replace onImportFromFile and onImportFromText props with single onImportClick prop:
```typescript
<ProjectSettings
  metadata={metadata}
  onUpdate={handleUpdateMetadata}
  onExport={handleExportJSON}
  onImportClick={() => setShowPhishImportModal(true)}
  onOpenTechniqueLibrary={() => setShowTechniqueLibrary(true)}
/>
```

**5. Update CampaignManager props (lines 698-706):**
Add onImportClick prop:
```typescript
<CampaignManager
  isOpen={showCampaignManager}
  onClose={() => setShowCampaignManager(false)}
  onEditCampaign={handleEditCampaign}
  onCarousel={handleViewCarousel}
  currentProject={currentPhish}
  onImportClick={() => setShowCampaignImportModal(true)}
  campaigns={campaigns} // Add this so modal can check for duplicates
/>
```

**6. Add modal JSX (after CampaignCarouselModal around line 722):**
```typescript
{showPhishImportModal && (
  <PhishImportModal
    isOpen={showPhishImportModal}
    onClose={() => setShowPhishImportModal(false)}
    onImport={handlePhishImport}
  />
)}
{showCampaignImportModal && (
  <CampaignImportModal
    isOpen={showCampaignImportModal}
    onClose={() => setShowCampaignImportModal(false)}
    onImport={handleCampaignImport}
    existingCampaigns={campaigns}
  />
)}
```

**IMPORTANT:**
- Pass campaigns prop to CampaignManager so it can pass to CampaignImportModal
- Don't remove handleImportJSON function - PhishImportModal uses it via handlePhishImport
- Place modals after existing modals (after CampaignCarouselModal) for proper z-index stacking
  </action>
  <verify>
Check App.tsx has:
- Import statements for PhishImportModal and CampaignImportModal
- showPhishImportModal and showCampaignImportModal state variables
- handlePhishImport and handleCampaignImport handlers
- ProjectSettings with onImportClick prop (NOT onImportFromFile/onImportFromText)
- CampaignManager with onImportClick and campaigns props
- PhishImportModal and CampaignImportModal JSX elements
  </verify>
  <done>
App.tsx properly manages import modal states and handlers
  </done>
</task>

<task type="auto">
  <name>Update ProjectSettings to use modal trigger</name>
  <files>src/components/ProjectSettings.tsx</files>
  <action>
Modify src/components/ProjectSettings.tsx to replace expanding menu with modal trigger:

**1. Update interface (lines 4-11):**
Remove onImportFromFile and onImportFromText, add onImportClick:
```typescript
interface ProjectSettingsProps {
  metadata: ProjectMetadata
  onUpdate: (metadata: ProjectMetadata) => void
  onExport?: () => void
  onImportClick?: () => void  // NEW: Replaces file/text import props
  onOpenTechniqueLibrary?: () => void
}
```

**2. Remove unused state (lines 21-23):**
Delete importText and importError state - modal handles these now:
```typescript
// DELETE these lines:
const [importText, setImportText] = useState('')
const [importError, setImportError] = useState<string | null>(null)
```

**3. Delete old import handlers (lines 54-93):**
Remove handleFileImport, handleTextImport, and handleImportTextChange functions - modal handles import logic.

**4. Simplify return JSX (lines 95-202):**
Replace expanding menu pattern with simple button:
- Remove menuOpen state toggle (lines 99-105)
- Remove {menuOpen && (...)} wrapper for settings content (lines 108-199)
- Remove file import section (lines 165-176)
- Remove text import section (lines 178-196)
- Add import button in export-import section:
```typescript
<div className="export-import-section">
  <button
    onClick={onExport}
    disabled={!onExport}
    className="export-json-button"
    type="button"
  >
    Export Phish
  </button>
  <button
    onClick={onImportClick}
    disabled={!onImportClick}
    className="import-json-button"
    type="button"
    style={{ marginLeft: '8px' }}
  >
    Import Phish
  </button>
</div>
```

Keep title, author, created date, and Manage Techniques button unchanged.

**IMPORTANT:**
- Don't delete ProjectSettings entirely - title/author editing and export functionality remain
- Import button should be next to Export button for logical grouping
- Remove all import error handling code - modal handles this
- Remove menuOpen state - no longer needed with modal pattern
  </action>
  <verify>
Check ProjectSettings.tsx has:
- onImportClick prop in interface (NOT onImportFromFile/onImportFromText)
- No importText, importError state variables
- No handleFileImport, handleTextImport functions
- "Import Phish" button with onClick={onImportClick}
- No expanding menu pattern
  </verify>
  <done>
ProjectSettings triggers modal on import click, no layout shift
  </done>
</task>

<task type="auto">
  <name>Update CampaignManager to use modal trigger</name>
  <files>src/components/campaign/CampaignManager.tsx</files>
  <action>
Modify src/components/campaign/CampaignManager.tsx to replace hidden file input with modal trigger:

**1. Update interface (lines 8-14):**
Add onImportClick and campaigns props:
```typescript
interface CampaignManagerProps {
  isOpen: boolean;
  onClose: () => void;
  onEditCampaign: (campaign: Campaign) => void;
  onCarousel?: (campaign: Campaign) => void;
  currentProject?: any;
  onImportClick?: () => void;  // NEW
  campaigns?: Campaign[];      // NEW - passed to import modal
}
```

**2. Remove unused state (lines 19-20):**
Delete importError state and fileInputRef - modal handles these:
```typescript
// DELETE these lines:
const [importError, setImportError] = useState<string | null>(null);
const fileInputRef = useRef<HTMLInputElement>(null);
```

**3. Delete old import handlers (lines 83-122):**
Remove handleImportClick, handleFileChange functions - modal handles import logic.

**4. Remove hidden file input from JSX (lines 330-336):**
Delete the entire input element with ref={fileInputRef}.

**5. Remove importError display (lines 337-341):**
Delete the conditional error message div.

**6. Update Import button handler (lines 282-296):**
Change from triggering hidden file input to calling onImportClick:
```typescript
<button
  onClick={onImportClick}  // Changed from handleImportClick
  style={{
    padding: '8px 16px',
    backgroundColor: '#f8f9fa',
    color: '#6c757d',
    border: '1px solid #6c757d',
    borderRadius: '6px',
    fontSize: '14px',
    fontWeight: '500',
    cursor: 'pointer',
  }}
>
  Import
</button>
```

**7. Update component function signature (line 16):**
Destructure new props:
```typescript
export function CampaignManager({ isOpen, onClose, onEditCampaign, onCarousel, currentProject, onImportClick, campaigns }: CampaignManagerProps) {
```

**IMPORTANT:**
- Don't delete CampaignManager entirely - campaign list, search, create, export remain
- onImportClick is optional prop (button disabled if not provided)
- campaigns prop is optional (passed through to modal if available)
- Remove all file input cleanup code - modal handles this
  </action>
  <verify>
Check CampaignManager.tsx has:
- onImportClick and campaigns in interface props
- No importError state variable
- No fileInputRef
- No handleImportClick, handleFileChange functions
- No hidden file input element
- No importError display div
- Import button calls onImportClick (not handleImportClick)
  </verify>
  <done>
CampaignManager triggers modal on import click, no hidden file input
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Import modals integrated into App, ProjectSettings, and CampaignManager</what-built>
  <how-to-verify>
1. Start the app: npm run dev
2. Click "Import / Export" in ProjectSettings header
   - Verify: Modal opens (no expanding menu, no layout shift)
   - Verify: Press Escape key, modal closes
   - Verify: Click outside modal (backdrop), modal closes
3. Test phish import via text paste:
   - Open modal, paste valid phish JSON (export a phish first)
   - Click Import
   - Verify: Data loads correctly, modal closes
4. Test phish import via file upload:
   - Export a phish to file
   - Open modal, click "Upload JSON file", select file
   - Verify: Data loads correctly, modal closes
5. Test invalid JSON:
   - Open modal, paste "invalid json"
   - Click Import
   - Verify: Error message shows inline, modal stays open
6. Click "Campaigns" button, then "Import" button in CampaignManager
   - Verify: Modal opens
   - Verify: Escape key and backdrop click close modal
7. Test campaign import:
   - Export a campaign, import via file or text
   - Verify: Campaign appears in list
8. Test duplicate campaign ID:
   - Import same campaign twice
   - Verify: Second import adds "(copy)" suffix
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
- App.tsx compiles without errors
- ProjectSettings compiles without errors
- CampaignManager compiles without errors
- Both modals open from their respective trigger buttons
- Escape key closes both modals
- Backdrop click closes both modals
- File upload works for both phish and campaign
- Text paste works for both phish and campaign
- Invalid JSON shows error message
- Valid import closes modal and loads data
</verification>

<success_criteria>
Import modals fully integrated and working for both phish and campaign imports
</success_criteria>

<output>
After completion, create `.planning/phases/17-import-ux-improvements/17-03-SUMMARY.md`
</output>
