---
phase: 08-deferred-v1-0-work
plan: 07
type: execute
wave: 2
depends_on: [08-05]
files_modified:
  - src/utils/storage.ts
  - src/types/library.ts
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Project JSON export includes custom techniques"
    - "Project JSON import restores custom techniques"
    - "Import validation accepts custom techniques in project data"
    - "Built-in techniques are referenced by ID only (not duplicated in export)"
  artifacts:
    - path: "src/utils/storage.ts"
      provides: "Extended export/import with custom techniques"
      exports: ["exportProjectJSON", "importProjectJSON"]
  key_links:
    - from: "src/utils/storage.ts"
      to: "src/types/library.ts"
      via: "Import CustomTechnique type"
      pattern: "import.*CustomTechnique"
    - from: "src/App.tsx"
      to: "exportProjectJSON"
      via: "Pass custom techniques to export function"
      pattern: "exportProjectJSON.*customTechniques"
---

<objective>
Project export includes custom techniques for portability.

Purpose: Users can share projects with custom techniques - the techniques travel with the project JSON, not stuck in LocalStorage.
Output: Extended ProjectJSON interface and export/import functions to include custom techniques.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/08-deferred-v1-0-work/08-DEFERRED-V1-0-WORK-RESEARCH.md

# Only reference prior plan SUMMARYs if genuinely needed
@.planning/phases/08-deferred-v1-0-work/08-05-SUMMARY.md
@src/utils/storage.ts
@src/types/library.ts
@src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend ProjectJSON with custom techniques</name>
  <files>src/utils/storage.ts, src/types/library.ts</files>
  <action>
    Update project export/import to include custom techniques:

    1. In src/types/library.ts, update or create ProjectJSONExtended:
       - Add customTechniques: Record<string, CustomTechnique> field
       - Keep builtInTechniques as optional reference (array of IDs or objects)

    2. In src/utils/storage.ts:
       - Update ProjectJSON interface to include customTechniques
       - Update exportProjectJSON signature:
         - Add customTechniques parameter
         - Include customTechniques in exported JSON
       - Update importProjectJSON:
         - Accept customTechniques in JSON
         - Validate customTechniques structure if present
         - Return customTechniques in parsed result

    Export structure:
    ```json
    {
      "metadata": {...},
      "htmlSource": "...",
      "annotations": {...},
      "scoring": {...},
      "inputMode": "html",
      "customTechniques": {
        "CUSTOM-123": {
          "id": "CUSTOM-123",
          "name": "...",
          "isCustom": true,
          ...
        }
      }
    }
    ```

    Reference RESEARCH.md pitfall #3 (lines 382-406) for the correct pattern.

    Do NOT include full built-in techniques in export - they're already in techniques.json and bloat the export.
  </action>
  <verify>grep -q "customTechniques" src/utils/storage.ts && grep -q "customTechniques" src/types/library.ts</verify>
  <done>ProjectJSON extended with customTechniques field, export/import updated</done>
</task>

<task type="auto">
  <name>Task 2: Wire custom techniques into App.tsx export/import</name>
  <files>src/App.tsx</files>
  <action>
    Update App.tsx to pass custom techniques to export/import:

    1. Import useCustomTechniques hook
    2. Destructure customTechniques from useCustomTechniques()
    3. Update handleExportJSON:
       - Pass customTechniques to exportProjectJSON
    4. Update handleImportJSON:
       - Extract customTechniques from imported project
       - Merge customTechniques into LocalStorage (don't overwrite existing)
       - Trigger re-render to show imported techniques

    Merge strategy for import:
    - If imported technique ID doesn't exist locally, add it
    - If imported technique ID exists locally and timestamps differ, keep the newer one
    - This allows sharing techniques across projects without data loss

    Do NOT automatically delete existing custom techniques on import - merge instead.
  </action>
  <verify>grep -q "useCustomTechniques" src/App.tsx && grep -q "customTechniques" src/App.tsx</verify>
  <done>App.tsx exports/imports custom techniques with project JSON</done>
</task>

</tasks>

<verification>
1. Export project JSON includes customTechniques field
2. Import project JSON restores custom techniques
3. Imported custom techniques appear in technique dropdown
4. Importing project with different custom techniques merges both sets
5. Export size is reasonable (built-in techniques not duplicated)
</verification>

<success_criteria>
- Projects with custom techniques are fully portable
- Import/export handles custom techniques correctly
- Merge strategy prevents data loss when sharing
- Built-in techniques not duplicated in export
</success_criteria>

<output>
After completion, create `.planning/phases/08-deferred-v1-0-work/08-07-SUMMARY.md`
</output>
