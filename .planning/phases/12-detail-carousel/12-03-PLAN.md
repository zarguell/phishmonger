---
phase: 12-detail-carousel
plan: 03
type: execute
wave: 2
depends_on: [12-01, 12-02]
files_modified:
  - src/components/campaign/CampaignCarouselModal.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate between carousel view and read-only editor view"
    - "View state persists (carousel doesn't remount when switching views)"
    - "Scroll position maintained when returning from editor"
  artifacts:
    - path: "src/components/campaign/CampaignCarouselModal.tsx"
      provides: "Modal container combining carousel and read-only editor views"
      min_lines: 80
      exports: ["CampaignCarouselModal"]
  key_links:
    - from: "CampaignCarouselModal.tsx"
      to: "src/components/campaign/CampaignCarousel.tsx"
      via: "Import and conditional rendering"
      pattern: "CampaignCarousel"
    - from: "CampaignCarouselModal.tsx"
      to: "src/components/campaign/ReadOnlyEditor.tsx"
      via: "Import and conditional rendering"
      pattern: "ReadOnlyEditor"
    - from: "CampaignCarouselModal.tsx"
      to: "src/types/campaign.ts"
      via: "Campaign type import"
      pattern: "Campaign"
---

<objective>
Create modal container integrating carousel and read-only editor with view state management

Purpose: Provide modal interface for browsing campaign phishes with seamless transitions between carousel and detail views
Output: CampaignCarouselModal component with view mode toggling and state persistence
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-detail-carousel/12-CONTEXT.md

@src/types/campaign.ts
@src/components/campaign/CampaignManager.tsx
@src/components/campaign/CampaignCarousel.tsx
@src/components/campaign/ReadOnlyEditor.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CampaignCarouselModal with view state management</name>
  <files>src/components/campaign/CampaignCarouselModal.tsx</files>
  <action>
Create CampaignCarouselModal component:

Props interface:
- isOpen: boolean
- onClose: () => void
- campaign: Campaign

State (per RESEARCH.md Pattern 3):
- viewMode: 'carousel' | 'readonly-editor' (useState, default 'carousel')
- selectedPhish: CampaignPhish | null (useState, default null)
- carouselScrollPosition: number (useState, default 0) - preserve scroll position

View switching logic:
- When card clicked: set selectedPhish, capture scroll position, set viewMode to 'readonly-editor'
- When back clicked: set viewMode to 'carousel', keep selectedPhish for highlight, restore scroll position

Modal structure (following CampaignManager.tsx pattern):
- Outer backdrop: fixed, rgba(0,0,0,0.5), zIndex: 50, click-to-close
- Modal content: white, rounded, maxWidth: 90vw, maxHeight: 90vh, overflow: auto
- Header: Campaign name + close button (X)

Conditional rendering (keeps both mounted, toggles visibility):
```tsx
{viewMode === 'carousel' && (
  <CampaignCarousel
    campaign={campaign}
    onCardClick={handleCardClick}
    initialScrollPosition={carouselScrollPosition}
  />
)}

{viewMode === 'readonly-editor' && selectedPhish && (
  <ReadOnlyEditor
    phish={selectedPhish}
    onBack={handleBackToCarousel}
  />
)}
```

Handlers:
- handleCardClick: Saves scroll position, sets selectedPhish, switches to readonly-editor
- handleBackToCarousel: Switches to carousel mode, restores scroll position, keeps selectedPhish for highlight
- handleBackdropClick: Calls onClose if clicking outside modal content

Header content:
- Carousel mode: Show campaign name + phish count
- Editor mode: Show phish title
- Close button (X) always visible in top-right

Scroll position preservation (per RESEARCH.md Pitfall 3):
- Use ref on carousel container
- Before switching: save scrollContainerRef.current.scrollLeft to state
- After switching back: scrollContainerRef.current.scrollLeft = savedPosition

Styling:
- Follow CampaignManager modal pattern (lines 163-190)
- Inline styles, no external CSS
- Same borderRadius, boxShadow, spacing as existing modals
</action>
  <verify>
File exists, exports CampaignCarouselModal, handles view switching, preserves scroll position
</verify>
  <done>
CampaignCarouselModal opens, switches between carousel/editor views, preserves scroll, closes properly
</done>
</task>

</tasks>

<verification>
1. CampaignCarouselModal accepts isOpen/onClose/campaign props
2. Modal renders campaign carousel when isOpen=true
3. Clicking card switches to read-only editor view
4. Back button returns to carousel with scroll position preserved
5. Close button (X) and backdrop click close modal
6. Selected phish is highlighted in carousel when returning from editor
7. View switching doesn't cause carousel remount (no flicker, no position reset)
</verification>

<success_criteria>
1. User can open carousel modal from campaign list
2. User can click card to view phish in read-only editor
3. User can return to carousel with preserved scroll position
4. Modal close works from both views
</success_criteria>

<output>
After completion, create `.planning/phases/12-detail-carousel/12-03-SUMMARY.md`
</output>
